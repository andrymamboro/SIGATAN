{"version":3,"mappings":"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","names":["Card","lazy","__vitePreload","import","then","m","default","CardContent","Button","n","d","TanahForm","__VITE_PRELOAD__","FormTanah","navigate","useNavigate","searchParams","useSearchParams","tanahId","get","user","setUser","useState","queryClient","useQueryClient","useEffect","userStr","localStorage","getItem","JSON","parse","e","data","tanahList","isLoading","tanahLoading","isFetching","tanahFetching","useQuery","queryKey","queryFn","async","error","supabase","from","select","Error","message","enabled","wilayahList","editingTanah","find","t","String","id","createMutation","useMutation","mutationFn","payload","created_by","username","full_name","insert","onSuccess","invalidateQueries","toast","success","onError","updateMutation","_id","dataWithoutId","updated_by","update","eq","jsx","className","children","length","jsxs","Suspense","fallback","variant","onClick","ArrowLeft","tanah","onSubmit","mutate","isPending","allTanahData","mapCenter","latitude","longitude","mapZoom"],"ignoreList":[],"sources":["../../Pages/FormTanah.jsx"],"sourcesContent":["// Contoh: ambil data dari tabel 'Tanah'\r\n// const { data, error } = await supabase.from('Tanah').select('*');\r\n\r\nimport { useState, useEffect, lazy, Suspense } from 'react';\r\nconst Card = lazy(() => import('@/components/ui/card').then(m => ({ default: m.Card })));\r\nconst CardContent = lazy(() => import('@/components/ui/card').then(m => ({ default: m.CardContent })));\r\nconst Button = lazy(() => import('@/components/ui/button').then(m => ({ default: m.Button })));\r\nconst TanahForm = lazy(() => import('@/components/forms/TanahForm'));\r\n\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { supabase } from '@/api/db';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { ArrowLeft } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\nexport default function FormTanah() {\r\n  const navigate = useNavigate();\r\n  const [searchParams] = useSearchParams();\r\n  const tanahId = searchParams.get('id');\r\n  const [user, setUser] = useState(undefined); // undefined: loading, null: not logged in\r\n  \r\n  const queryClient = useQueryClient();\r\n\r\n  useEffect(() => {\r\n    // Ambil user dari localStorage (hasil login)\r\n    const userStr = localStorage.getItem('user');\r\n    if (userStr) {\r\n      try {\r\n        setUser(JSON.parse(userStr));\r\n      } catch (e) {\r\n        setUser(null);\r\n      }\r\n    } else {\r\n      setUser(null);\r\n    }\r\n  }, []);\r\n\r\n\r\n  const {\r\n    data: tanahList = [],\r\n    isLoading: tanahLoading,\r\n    isFetching: tanahFetching\r\n  } = useQuery({\r\n    queryKey: ['tanah'],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase.from('tanah').select('*');\r\n      if (error) throw new Error(error.message);\r\n      return data || [];\r\n    },\r\n    enabled: user !== undefined && !!user,\r\n  });\r\n\r\n  const { data: wilayahList = [] } = useQuery({\r\n    queryKey: ['wilayah'],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase.from('wilayah').select('*');\r\n      if (error) throw new Error(error.message);\r\n      return data || [];\r\n    },\r\n  });\r\n\r\n  const editingTanah = tanahId ? tanahList.find(t => String(t.id) === String(tanahId)) : null;\r\n\r\n  const createMutation = useMutation({\r\n    mutationFn: async (data) => {\r\n      // Buat payload hanya field yang valid\r\n      const payload = {\r\n        ...data,\r\n        created_by: user?.username || user?.full_name || null,\r\n      };\r\n      const { error } = await supabase.from('tanah').insert([payload]);\r\n      if (error) throw new Error(error.message);\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries(['tanah']);\r\n      toast.success('Data tanah berhasil ditambahkan');\r\n      navigate('/datatanah');\r\n    },\r\n    onError: (error) => {\r\n      toast.error('Gagal menyimpan data: ' + (error.message || error));\r\n    },\r\n  });\r\n\r\n  const updateMutation = useMutation({\r\n    mutationFn: async ({ id, data }) => {\r\n      // Pastikan id tidak dikirim ke payload\r\n      const { id: _id, ...dataWithoutId } = data || {};\r\n      const payload = {\r\n        ...dataWithoutId,\r\n        updated_by: user?.username || user?.full_name || null,\r\n      };\r\n      const { error } = await supabase.from('tanah').update(payload).eq('id', id);\r\n      if (error) throw new Error(error.message);\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries(['tanah']);\r\n      toast.success('Data tanah berhasil diperbarui');\r\n      navigate('/datatanah');\r\n    },\r\n    onError: (error) => {\r\n      toast.error('Gagal update data: ' + (error.message || error));\r\n    },\r\n  });\r\n\r\n  const handleSubmit = (data) => {\r\n    if (editingTanah) {\r\n      updateMutation.mutate({ id: editingTanah.id, data });\r\n    } else {\r\n      createMutation.mutate(data);\r\n    }\r\n  };\r\n\r\n  if (user === undefined) {\r\n    // User is still loading\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-[200px]\">\r\n        <span className=\"text-white\">Memuat user...</span>\r\n      </div>\r\n    );\r\n  }\r\n  if ((tanahId && tanahLoading) || (tanahId && !editingTanah && !tanahLoading && tanahList.length > 0)) {\r\n    // Show loading if fetching tanah for edit, or if id is present but not found yet\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-[200px]\">\r\n        <span className=\"text-white\">Memuat data tanah...</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-1xl font-bold text-white\">\r\n            {editingTanah ? 'Edit Data Tanah' : 'Tambah Data Tanah Baru'}\r\n          </h1>\r\n          <p className=\"text-white text-sm mt-0\">\r\n            {editingTanah ? 'Perbarui informasi data tanah' : 'Tambahkan data tanah baru ke sistem'}\r\n          </p>\r\n        </div>\r\n         <Suspense fallback={<span>...</span>}>\r\n           <Button\r\n            className=\"text-white\"\r\n             variant=\"outline\"\r\n             onClick={() => navigate('/datatanah')}\r\n           >\r\n             <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n             Kembali\r\n           </Button>\r\n         </Suspense>\r\n      </div>\r\n\r\n      {/* Form */}\r\n       <Suspense fallback={<div>Memuat form...</div>}>\r\n         <Card className=\"border-0 shadow-md\">\r\n           <CardContent className=\"p-6\">\r\n             <TanahForm \r\n               tanah={editingTanah}\r\n               onSubmit={handleSubmit}\r\n               isLoading={createMutation.isPending || updateMutation.isPending}\r\n               wilayahList={wilayahList}\r\n               allTanahData={tanahList}\r\n               mapCenter={editingTanah && editingTanah.latitude && editingTanah.longitude ? [editingTanah.latitude, editingTanah.longitude] : undefined}\r\n               mapZoom={editingTanah ? 18 : undefined}\r\n             />\r\n           </CardContent>\r\n         </Card>\r\n       </Suspense>\r\n    </div>\r\n  );\r\n}\r\n"],"file":"FormTanah-CQLcueQ1.js"}