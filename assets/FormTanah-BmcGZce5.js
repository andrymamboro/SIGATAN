import{r as j,j as a,J as ta,O as M,K as y,ai as z,w as F,R as ka,aj as ia,a1 as ra,ak as oa,al as ca,a4 as ma,a6 as va,a7 as Na,a8 as ya,a9 as wa,E as Ca,am as Pa,an as Sa,H as Ta,l as Da,ao as Ka,D as Ba,v as da,G as ha,a0 as Aa,Z as G}from"./vendor-CDA6I53B.js";import{s as q}from"./db-CzWppX9X.js";import{C as K,b as E,c as I,a as B}from"./card-DKMhJA2Q.js";import{a as La,B as f}from"./index-yx-jgwg1.js";import{I as P}from"./input-CWJLU9W1.js";import{L as N}from"./label-wcoL3QN2.js";import{S as V,a as W,b as Q,c as Z,d as C}from"./select-DkHE2ADG.js";import{T as Ma,c as U}from"./tabs-bRrHKpzy.js";import{D as Fa,a as Ea,b as Ia,c as Ua}from"./dialog-DQrH_2W9.js";import{B as qa}from"./badge-BNLm1yiM.js";import{M as Oa}from"./MapPicker-C4Nnw46l.js";import"./leaflet-D651TNsF.js";import"./pdf-BL6BoWiN.js";import"./utils-DzPFn8M0.js";const X=j.forwardRef(({className:t,...m},i)=>a.jsx("textarea",{className:La("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:i,...m}));X.displayName="Textarea";const O=["","Satu","Dua","Tiga","Empat","Lima","Enam","Tujuh","Delapan","Sembilan"],Ra=["Sepuluh","Sebelas","Dua Belas","Tiga Belas","Empat Belas","Lima Belas","Enam Belas","Tujuh Belas","Delapan Belas","Sembilan Belas"];function A(t){if(t===0)return"Nol";if(t<0)return"Minus "+A(Math.abs(t));let m="";if(t>=1e9){const i=Math.floor(t/1e9);m+=(i===1?"Satu":A(i))+" Miliar ",t%=1e9}if(t>=1e6){const i=Math.floor(t/1e6);m+=(i===1?"Satu":A(i))+" Juta ",t%=1e6}if(t>=1e3){const i=Math.floor(t/1e3);m+=(i===1?"Seribu":A(i)+" Ribu")+" ",t%=1e3}if(t>=100){const i=Math.floor(t/100);m+=(i===1?"Seratus":O[i]+" Ratus")+" ",t%=100}if(t>=10&&t<=19&&(m+=Ra[t-10]+" ",t=0),t>=20){const i=Math.floor(t/10);m+=O[i]+" Puluh ",t%=10}return t>0&&(m+=O[t]+" "),m.trim()}function $a(t){return!t||isNaN(t)?"":A(Math.floor(Number(t)))+" Rupiah"}function Ha(t){if(!t||isNaN(t))return"";const m=Number(t),i=Math.floor(m),b=m%1;let p=A(i);if(b>0){const d=b.toFixed(2).split(".")[1],k=parseInt(d[0]),x=parseInt(d[1]);p+=" Koma",k>0?p+=" "+O[k]:p+=" Nol",x>0&&(p+=" "+O[x])}return p+=" Meter Persegi",p}async function ua(t,m){let i=q.from("pejabat").select("*").eq("kecamatan",t).eq("aktif",!0);m&&(i=i.eq("kelurahan",m));const{data:b,error:p}=await i;if(p)throw p;const d={"PPATK Kecamatan":"camat",Camat:"camat",Lurah:"lurah","Kasi Pemerintahan":"kasi_pemerintahan","Staf Administrasi Kecamatan":"administrasi_kecamatan"},k={};return b.forEach(x=>{const g=d[x.jabatan];g&&(k[`nama_${g}`]=x.nama,k[`nip_${g}`]=x.nip,k[`jabatan_${g}`]=x.jabatan)}),k}const c=({label:t,name:m,type:i="text",required:b=!1,placeholder:p="",value:d,onChange:k,disabled:x,icon:g})=>{const S=x&&!d?p:void 0;return a.jsxs("div",{className:"space-y-2",children:[a.jsxs(N,{htmlFor:m,className:"text-blue-700 font-bold flex items-center gap-1",children:[g&&a.jsx(g,{className:"w-4 h-4 text-emerald-500 mr-1"})," ",t," ",b&&a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(P,{id:m,type:i,value:d||"",onChange:k,placeholder:S,required:b,disabled:x}),x&&!d&&p&&a.jsx("div",{className:"text-xs text-slate-400 italic mt-1",children:p})]})};function Ja({tanah:t,onSubmit:m,isLoading:i,wilayahList:b=[],allTanahData:p=[],user:d}){j.useEffect(()=>{s.nik_pemilik&&!R.nik_pemilik&&$(e=>({...e,nik_pemilik:!0}))},[]);const k=e=>{$(l=>({...l,[e]:!0}))},[x,g]=j.useState({}),[S,T]=j.useState(!1),[w,r]=j.useState("pemilik"),[u,D]=j.useState({}),[R,$]=j.useState({}),[H,Y]=j.useState(!1),[la,pa]=j.useState(""),[J,aa]=j.useState(1),ea=10,xa=()=>({nama_pemilik:"",nik_pemilik:"",tempat_tgl_lahir_pemilik:"",pekerjaan_pemilik:"",alamat_pemilik:"",luas_perkalian:"",luas_terbilang:"",luas_meter:"",batas_utara:"",batas_timur:"",batas_selatan:"",batas_barat:"",lokasi:"",latitude:"",longitude:"",location_type:"marker",polygon_coords:null,asal_usul:"",nomor_skpt:"",tanggal_skpt:"",nama_penerima:"",nik_penerima:"",tempat_tgl_lahir_penerima:"",pekerjaan_penerima:"",alamat_penerima:"",atas_nama:"",transaksi:"",harga:"",harga_terbilang:"",nomor_penyerahan:"",tanggal_penyerahan:"",kecamatan:"",kelurahan:"",status:"Proses",nama_camat:"",nip_camat:"",jabatan_camat:"",nama_lurah:"",nip_lurah:"",nama_kasi_pemerintahan:"",nip_kasi_pemerintahan:"",jabatan_kasi_pemerintahan:"",nama_administrasi_kecamatan:"",nip_administrasi_kecamatan:"",jabatan_administrasi_kecamatan:"",...t||{}}),[s,L]=j.useState(xa()),[ga,ba]=j.useState([]);j.useEffect(()=>{if(t){const e={...s,...t};if(e.polygon_coords&&typeof e.polygon_coords=="string")try{e.polygon_coords=JSON.parse(e.polygon_coords)}catch(l){console.error("Failed to parse polygon_coords:",l),e.polygon_coords=null}L(e)}},[t]),j.useEffect(()=>{let e=s.kecamatan;if(d?.role==="admin_kecamatan"&&(e=d.kecamatan),e){const l=b.filter(o=>o.kecamatan===e).map(o=>o.kelurahan);ba([...new Set(l)])}s.kecamatan&&s.kelurahan?ua(s.kecamatan,s.kelurahan).then(l=>{g(l||{}),Object.entries(l).some(([h,v])=>v&&v!==s[h])&&L(h=>({...h,...l}))}):g({})},[s.kecamatan,s.kelurahan,b,d]);let na=[...new Set(b.map(e=>e.kecamatan))];d?.role==="admin_kecamatan"&&(na=d.kecamatan?[d.kecamatan]:[],!s.kecamatan&&d.kecamatan&&setTimeout(()=>{n("kecamatan",d.kecamatan)},0));const n=(e,l)=>{if(L(o=>({...o,[e]:l,...e==="luas_meter"&&l?{luas_terbilang:Ha(l)}:{},...e==="harga"&&l?{harga_terbilang:$a(l)}:{}})),e==="kecamatan"||e==="kelurahan"){const o=e==="kecamatan"?l:s.kecamatan,h=e==="kelurahan"?l:s.kelurahan;o&&h?ua(o,h).then(v=>{g(v||{}),L(_=>({..._,...v}))}):g({})}},ja=e=>{e.preventDefault();const l={...s,tempat_tgl_lahir_pemilik:s.tempat_tgl_lahir_pemilik||"",tempat_tgl_lahir_penerima:s.tempat_tgl_lahir_penerima||"",luas_meter:s.luas_meter?Number(s.luas_meter):null,harga:s.harga?Number(s.harga):null,latitude:s.latitude?Number(s.latitude):null,longitude:s.longitude?Number(s.longitude):null,polygon_coords:s.polygon_coords||null,location_type:s.location_type||"marker",tanggal_skpt:s.tanggal_skpt?s.tanggal_skpt:null,tanggal_penyerahan:s.tanggal_penyerahan?s.tanggal_penyerahan:null};try{m(l)}catch(o){alert("Gagal menyimpan data: "+(o?.message||o))}},_a=e=>{const l={};return["nip_camat","nip_lurah","nip_kasi_pemerintahan","nip_administrasi_kecamatan"].forEach(h=>{const v=s[h];v&&!/^\d{18}$/.test(v)&&(l[h]="NIP harus 18 digit angka")}),e==="pemilik"?(s.nama_pemilik||(l.nama_pemilik="Nama Pemilik harus diisi"),s.nik_pemilik?/^\d{16}$/.test(s.nik_pemilik)||(l.nik_pemilik="NIK harus 16 digit angka"):l.nik_pemilik="NIK harus diisi"):e==="tanah"&&(s.kecamatan||(l.kecamatan="Kecamatan harus dipilih"),s.kelurahan||(l.kelurahan="Kelurahan harus dipilih")),D(l),Object.keys(l).length===0},sa=()=>{if(!_a(w))return;D({});const e=["pemilik","tanah","penerima","dokumen"],l=e.indexOf(w);l<e.length-1&&r(e[l+1])};return a.jsxs(a.Fragment,{children:[a.jsx("form",{onSubmit:ja,className:"space-y-6",children:a.jsxs(Ma,{value:w,onValueChange:r,className:"w-full",children:[a.jsx("div",{className:"w-full flex flex-col items-center mb-2",children:a.jsx("div",{className:"flex w-full max-w-2xl justify-between items-center gap-2",children:[{label:"Pemilik",value:"pemilik",icon:ta},{label:"Tanah",value:"tanah",icon:M},{label:"Koordinat",value:"koordinat",icon:y},{label:"Penerima",value:"penerima",icon:z},{label:"Dokumen",value:"dokumen",icon:F}].map((e,l,o)=>a.jsxs(ka.Fragment,{children:[a.jsxs("button",{type:"button",onClick:()=>r(e.value),className:"flex flex-col items-center flex-1 focus:outline-none group","aria-current":w===e.value?"step":void 0,children:[a.jsx("div",{className:`rounded-full w-8 h-8 flex items-center justify-center font-bold border-2 transition-all duration-200 mb-1 ${w===e.value?"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white border-blue-900 scale-110 shadow-lg":"bg-white text-slate-900 border-slate-400 group-hover:bg-slate-100"}`,children:l+1}),a.jsxs("span",{className:`text-xs font-medium flex items-center gap-1 ${w===e.value?"text-slate-900":"text-slate-500"}`,children:[e.icon&&a.jsx(e.icon,{className:"w-4 h-4"})," ",e.label]})]}),l<o.length-1&&a.jsx("div",{className:`flex-1 h-1 mx-1 rounded bg-gradient-to-r ${l<o.findIndex(h=>h.value===w)?"from-slate-900 via-slate-800 to-blue-900":"from-slate-200 to-slate-200"}`})]},e.value))})}),a.jsx(U,{value:"pemilik",children:a.jsxs(K,{className:"border-0 shadow-md",children:[a.jsx(E,{className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white rounded-t-lg",children:a.jsxs(I,{className:"flex items-center gap-2",children:[a.jsx(ta,{className:"w-5 h-5"}),"Data Pemilik"]})}),a.jsxs(B,{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(c,{label:"Nama Pemilik",name:"nama_pemilik",required:!0,placeholder:"Masukkan nama lengkap",value:s.nama_pemilik,onChange:e=>n("nama_pemilik",e.target.value),icon:ia}),u.nama_pemilik&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.nama_pemilik})]}),a.jsxs("div",{children:[a.jsx(c,{label:"NIK",name:"nik_pemilik",required:!0,placeholder:"16 digit NIK",value:s.nik_pemilik,onChange:e=>n("nik_pemilik",e.target.value),onBlur:()=>k("nik_pemilik"),icon:ra}),u.nik_pemilik&&(R.nik_pemilik||t)&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.nik_pemilik})]}),a.jsx(c,{label:"Tempat, Tanggal Lahir atau Umur",name:"tempat_tgl_lahir_pemilik",placeholder:"Contoh: Palu, 20 Desember 1980",value:s.tempat_tgl_lahir_pemilik,onChange:e=>n("tempat_tgl_lahir_pemilik",e.target.value),icon:oa}),a.jsx(c,{label:"Pekerjaan",name:"pekerjaan_pemilik",placeholder:"Jenis pekerjaan",value:s.pekerjaan_pemilik,onChange:e=>n("pekerjaan_pemilik",e.target.value),icon:ca}),a.jsxs("div",{className:"md:col-span-2 space-y-2",children:[a.jsxs(N,{className:"text-blue-700 font-bold flex items-center gap-2",children:[a.jsx(ma,{className:"h-4 w-4 text-green-700"}),"Alamat"]}),a.jsx(X,{value:s.alamat_pemilik||"",onChange:e=>n("alamat_pemilik",e.target.value),placeholder:"Alamat lengkap",className:"border-slate-200"})]}),a.jsxs("div",{className:"md:col-span-2 flex justify-between pt-6 border-t border-slate-200",children:[a.jsxs("div",{className:"text-sm text-slate-500",children:[a.jsx("span",{className:"font-medium",children:"Step 1 of 4:"})," Data Pemilik"]}),a.jsxs(f,{type:"button",onClick:sa,className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white hover:brightness-110 px-8",children:["Selanjutnya",a.jsx(y,{className:"w-4 h-4 ml-2"})]})]})]})]})}),a.jsx(U,{value:"tanah",children:a.jsxs(K,{className:"border-0 shadow-md",children:[a.jsx(E,{className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white rounded-t-lg",children:a.jsxs(I,{className:"flex items-center gap-2",children:[a.jsx(y,{className:"w-5 h-5"}),"Data Tanah"]})}),a.jsxs(B,{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs(N,{className:"text-blue-700 font-bold flex items-center gap-1",children:[a.jsx(y,{className:"w-4 h-4 text-emerald-500 mr-1"}),"Kecamatan ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs(V,{value:s.kecamatan,onValueChange:e=>n("kecamatan",e),disabled:d?.role==="admin_kecamatan",children:[a.jsx(W,{className:u.kecamatan?"border-red-500":"border-blue-500",children:a.jsx(Q,{placeholder:"Pilih Kecamatan"})}),a.jsx(Z,{children:na.filter(e=>d?.role==="admin_kecamatan"?e===d?.kecamatan:!0).map(e=>a.jsx(C,{value:e,children:e},e))})]}),u.kecamatan&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.kecamatan})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(N,{className:"text-blue-700 font-bold flex items-center gap-1",children:[a.jsx(y,{className:"w-4 h-4 text-emerald-500 mr-1"}),"Kelurahan ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs(V,{value:s.kelurahan,onValueChange:e=>n("kelurahan",e),children:[a.jsx(W,{className:u.kelurahan?"border-red-500":"border-blue-500",children:a.jsx(Q,{placeholder:"Pilih Kelurahan"})}),a.jsx(Z,{children:ga.map(e=>a.jsx(C,{value:e,children:e},e))})]}),u.kelurahan&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.kelurahan})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(N,{className:"text-blue-700 font-bold flex items-center gap-1",children:[a.jsx(y,{className:"w-4 h-4 text-emerald-500 mr-1"}),"Lokasi ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(P,{value:s.lokasi||"",onChange:e=>n("lokasi",e.target.value),placeholder:"Deskripsi lokasi tanah",className:"border-blue-500 border-2",required:!0})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(c,{className:"w-16",label:"Luas (P x L)",name:"luas_perkalian",placeholder:"10 x 15",value:s.luas_perkalian,onChange:e=>n("luas_perkalian",e.target.value),icon:M}),a.jsx(c,{className:"w-16",label:"Luas (m²)",name:"luas_meter",type:"number",step:"1",placeholder:"150",value:s.luas_meter,onChange:e=>n("luas_meter",e.target.value),icon:M}),a.jsxs("div",{className:"space-y-0 col-span-2",children:[a.jsxs(N,{htmlFor:"luas_terbilang",className:"text-blue-700 font-bold flex items-center gap-1",children:[a.jsx(F,{className:"w-4 h-4 text-emerald-500 mr-1"}),"Luas Terbilang"]}),a.jsx(P,{className:"col-span-2",id:"luas_terbilang",type:"text",value:s.luas_terbilang||"",onChange:e=>n("luas_terbilang",e.target.value),placeholder:"Otomatis terisi",readOnly:!0})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(c,{label:"Batas Utara",name:"batas_utara",placeholder:"Berbatasan dengan...",value:s.batas_utara,onChange:e=>n("batas_utara",e.target.value),icon:va}),a.jsx(c,{label:"Batas Timur",name:"batas_timur",placeholder:"Berbatasan dengan...",value:s.batas_timur,onChange:e=>n("batas_timur",e.target.value),icon:Na}),a.jsx(c,{label:"Batas Selatan",name:"batas_selatan",placeholder:"Berbatasan dengan...",value:s.batas_selatan,onChange:e=>n("batas_selatan",e.target.value),icon:ya}),a.jsx(c,{label:"Batas Barat",name:"batas_barat",placeholder:"Berbatasan dengan...",value:s.batas_barat,onChange:e=>n("batas_barat",e.target.value),icon:wa})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(N,{className:"text-blue-700 font-bold",children:"Asal Usul Tanah"}),a.jsxs(qa,{variant:"outline",className:"cursor-pointer hover:bg-blue-50 text-blue-600 border-blue-300",onClick:()=>Y(!0),children:[a.jsx(Ca,{className:"w-3 h-3 mr-1"}),"Lihat Contoh"]})]}),a.jsx(X,{value:s.asal_usul||"",onChange:e=>n("asal_usul",e.target.value),placeholder:"Warisan, Pembelian, dll",className:"border-blue-500 border-2",rows:5})]}),a.jsxs("div",{className:"flex justify-between pt-6 border-t border-slate-200",children:[a.jsxs(f,{type:"button",onClick:()=>r("pemilik"),className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white hover:brightness-110 px-8",children:[a.jsx(ta,{className:"w-4 h-4 mr-2"}),"Kembali"]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("span",{className:"text-sm text-slate-500",children:[a.jsx("span",{className:"font-medium",children:"Step 2 of 4:"})," Data Tanah"]}),a.jsxs(f,{type:"button",onClick:sa,className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white hover:brightness-110 px-8",children:["Selanjutnya",a.jsx(y,{className:"w-4 h-4 ml-2"})]})]})]})]})]})}),a.jsx(U,{value:"penerima",children:a.jsxs(K,{className:"border-0 shadow-md",children:[a.jsx(E,{className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white rounded-t-lg",children:a.jsxs(I,{className:"flex items-center gap-2",children:[a.jsx(z,{className:"w-5 h-5"}),"Data Penerima / Transaksi"]})}),a.jsxs(B,{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(c,{label:"Nama Penerima",name:"nama_penerima",placeholder:"Nama lengkap",value:s.nama_penerima,onChange:e=>n("nama_penerima",e.target.value),icon:ia}),a.jsx(c,{label:"NIK Penerima",name:"nik_penerima",placeholder:"16 digit NIK",value:s.nik_penerima,onChange:e=>n("nik_penerima",e.target.value),icon:ra}),a.jsx(c,{label:"Tempat, Tanggal Lahir atau Umur",name:"tempat_tgl_lahir_penerima",placeholder:"Contoh: Palu, 20 Desember 1980",value:s.tempat_tgl_lahir_penerima,onChange:e=>n("tempat_tgl_lahir_penerima",e.target.value),icon:oa}),a.jsx(c,{label:"Pekerjaan",name:"pekerjaan_penerima",placeholder:"Jenis pekerjaan",value:s.pekerjaan_penerima,onChange:e=>n("pekerjaan_penerima",e.target.value),icon:ca})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(N,{className:"text-blue-700 font-bold flex items-center gap-2",children:[a.jsx(ma,{className:"h-4 w-4 text-green-700"}),"Alamat"]}),a.jsx(X,{value:s.alamat_penerima||"",onChange:e=>n("alamat_penerima",e.target.value),placeholder:"Alamat lengkap",className:"border-slate-200"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(c,{label:"Atas Nama",name:"atas_nama",placeholder:"Atas nama",value:s.atas_nama,onChange:e=>n("atas_nama",e.target.value)}),a.jsxs("div",{className:"",children:[a.jsx(N,{className:"text-blue-700 font-bold",children:"Jenis Transaksi"}),a.jsxs(V,{value:s.transaksi,onValueChange:e=>n("transaksi",e),children:[a.jsx(W,{className:"border-b-blue-500 border-b-2",children:a.jsx(Q,{placeholder:"Pilih jenis transaksi"})}),a.jsxs(Z,{children:[a.jsx(C,{value:"Jual Beli",children:"Jual Beli"}),a.jsx(C,{value:"Hibah/Pemberian",children:"Hibah/Pemberian"})]})]})]})]}),s.transaksi==="Jual Beli"&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(c,{label:"Harga (Rp)",name:"harga",type:"number",placeholder:"0",value:s.harga,onChange:e=>n("harga",e.target.value)}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(N,{htmlFor:"harga_terbilang",className:"text-slate-700 font-medium",children:"Harga Terbilang"}),a.jsx(P,{id:"harga_terbilang",type:"text",value:s.harga_terbilang||"",onChange:e=>n("harga_terbilang",e.target.value),placeholder:"Otomatis terisi",className:"border-slate-200 focus:border-blue-500 focus:ring-blue-500 bg-slate-50",readOnly:!0})]})]}),a.jsxs("div",{className:"flex justify-between pt-6 border-t border-slate-200",children:[a.jsxs(f,{type:"button",onClick:()=>r("tanah"),className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white hover:brightness-110 px-8",children:[a.jsx(y,{className:"w-4 h-4 mr-2"}),"Kembali"]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("span",{className:"text-sm text-slate-500",children:[a.jsx("span",{className:"font-medium",children:"Step 3 of 4:"})," Data Penerima"]}),a.jsxs(f,{type:"button",onClick:sa,className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white hover:brightness-110 px-8",children:["Selanjutnya",a.jsx(F,{className:"w-4 h-4 ml-2"})]})]})]})]})]})}),a.jsx(U,{value:"koordinat",children:a.jsxs(K,{className:"border-0 shadow-md",children:[a.jsx(E,{className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white rounded-t-lg",children:a.jsxs(I,{className:"flex items-center gap-2",children:[a.jsx(F,{className:"w-5 h-5"}),"Koordinat"]})}),a.jsx(B,{className:"p-6",children:a.jsxs("div",{className:"text-slate-700",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(N,{className:"text-green-700 font-bold",children:"Koordinat Lokasi"}),a.jsxs(f,{type:"button",onClick:()=>T(!0),className:"bg-gradient-to-b from-green-700 via-green-800 to-emerald-900 text-white hover:brightness-110",size:"sm",children:[a.jsx(M,{className:"w-4 h-4 mr-2"}),"Pilih dari Peta"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(c,{label:"Latitude",name:"latitude",type:"number",step:"0.0000001",placeholder:"-6.xxxxx",value:s.latitude,onChange:e=>n("latitude",e.target.value)}),a.jsx(c,{label:"Longitude",name:"longitude",type:"number",step:"0.0000001",placeholder:"106.xxxxx",value:s.longitude,onChange:e=>n("longitude",e.target.value)})]}),(s.location_type==="polygon"||s.location_type==="polyline")&&a.jsxs("div",{className:"mt-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs(N,{className:"text-sm text-slate-600",children:["Koordinat ",s.location_type==="polygon"?"Polygon":"Polyline"," ",s.polygon_coords?`(${s.polygon_coords.length} titik)`:""]}),a.jsx(f,{size:"sm",variant:"outline",type:"button",onClick:()=>{const e=s.polygon_coords?[...s.polygon_coords]:[];e.push([Number(s.latitude)||0,Number(s.longitude)||0]),n("polygon_coords",e)},children:"+ Tambah Titik"})]}),s.polygon_coords&&s.polygon_coords.length>0?a.jsx("div",{className:"max-h-48 overflow-y-auto flex flex-col gap-1",children:s.polygon_coords.map((e,l)=>a.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 p-2 rounded",children:[a.jsxs("span",{className:"text-xs font-semibold text-slate-500 w-6",children:[l+1,"."]}),a.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-2",children:[a.jsx(P,{type:"number",step:"0.000001",value:e[0],onChange:o=>{const h=[...s.polygon_coords];h[l][0]=parseFloat(o.target.value)||0,n("polygon_coords",h)},className:"h-8 text-xs",placeholder:"Latitude"}),a.jsx(P,{type:"number",step:"0.000001",value:e[1],onChange:o=>{const h=[...s.polygon_coords];h[l][1]=parseFloat(o.target.value)||0,n("polygon_coords",h)},className:"h-8 text-xs",placeholder:"Longitude"})]}),a.jsx(f,{size:"sm",variant:"ghost",type:"button",onClick:()=>{const o=s.polygon_coords.filter((h,v)=>v!==l);n("polygon_coords",o.length>0?o:null)},className:"h-8 px-2 text-red-600 hover:text-red-700 hover:bg-red-50",children:"✕"})]},l))}):a.jsxs("div",{className:"text-center py-4 text-sm text-slate-400",children:["Belum ada titik ",s.location_type==="polygon"?"polygon":"polyline",". Gambar di peta atau tambah manual."]})]})]}),s.latitude&&s.longitude&&a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx(y,{className:"w-4 h-4 inline mr-1"}),s.location_type==="polygon"?"Polygon (Pusat): ":"Koordinat: ",s.latitude,", ",s.longitude," ",a.jsx("a",{href:`https://www.google.com/maps?q=${s.latitude},${s.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline ml-2",children:"Lihat di Google Maps →"})]}),s.location_type==="polygon"&&s.polygon_coords&&a.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:["✓ Polygon dengan ",s.polygon_coords.length," titik koordinat"]})]}),a.jsxs("div",{className:"flex justify-between pt-6 border-t border-slate-200 mt-8",children:[a.jsxs(f,{type:"button",className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white hover:brightness-110 px-8",onClick:()=>setActiveTab&&setActiveTab("tanah"),children:[a.jsx(M,{className:"w-4 h-4 mr-2"}),"Kembali"]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("span",{className:"text-sm text-slate-500",children:[a.jsx("span",{className:"font-medium",children:"Step 3 of 4:"})," Data Koordinat"]}),a.jsxs(f,{type:"button",className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white hover:brightness-110 px-8",onClick:()=>setActiveTab&&setActiveTab("dokumen"),children:["Selanjutnya",a.jsx(z,{className:"w-4 h-4 ml-2"})]})]})]})]})})]})}),a.jsx(U,{value:"dokumen",children:a.jsxs(K,{className:"border-0 shadow-md",children:[a.jsx(E,{className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white rounded-t-lg",children:a.jsxs(I,{className:"flex items-center gap-2",children:[a.jsx(F,{className:"w-5 h-5"}),"Data Dokumen"]})}),a.jsxs(B,{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(c,{label:"Nomor SKPT",name:"nomor_skpt",placeholder:"Nomor surat",value:s.nomor_skpt,onChange:e=>n("nomor_skpt",e.target.value)}),a.jsx(c,{label:"Tanggal SKPT",name:"tanggal_skpt",type:"date",value:s.tanggal_skpt,onChange:e=>n("tanggal_skpt",e.target.value)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(c,{label:"Nomor Penyerahan",name:"nomor_penyerahan",placeholder:"Nomor surat",value:s.nomor_penyerahan,onChange:e=>n("nomor_penyerahan",e.target.value)}),a.jsx(c,{label:"Tanggal Penyerahan",name:"tanggal_penyerahan",type:"date",value:s.tanggal_penyerahan,onChange:e=>n("tanggal_penyerahan",e.target.value)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx("div",{children:a.jsx(c,{label:"Nama Camat",name:"nama_camat",value:s.nama_camat,onChange:e=>n("nama_camat",e.target.value),disabled:!0,placeholder:x.nama_camat||""})}),a.jsx("div",{children:a.jsx(c,{label:"Nama Lurah",name:"nama_lurah",value:s.nama_lurah,onChange:e=>n("nama_lurah",e.target.value),disabled:!0,placeholder:x.nama_lurah||""})}),a.jsx("div",{children:a.jsx(c,{label:"Nama Kasi Pemerintahan",name:"nama_kasi_pemerintahan",value:s.nama_kasi_pemerintahan,onChange:e=>n("nama_kasi_pemerintahan",e.target.value),disabled:!0,placeholder:x.nama_kasi_pemerintahan||""})}),a.jsx("div",{children:a.jsx(c,{label:"Nama Administrasi Kecamatan",name:"nama_administrasi_kecamatan",value:s.nama_administrasi_kecamatan,onChange:e=>n("nama_administrasi_kecamatan",e.target.value),disabled:!0,placeholder:x.nama_administrasi_kecamatan||""})}),a.jsx("input",{type:"hidden",name:"nip_camat",value:s.nip_camat||""}),a.jsx("input",{type:"hidden",name:"jabatan_camat",value:s.jabatan_camat||""}),a.jsx("input",{type:"hidden",name:"nip_lurah",value:s.nip_lurah||""}),a.jsx("input",{type:"hidden",name:"jabatan_lurah",value:s.jabatan_lurah||""}),a.jsx("input",{type:"hidden",name:"nip_kasi_pemerintahan",value:s.nip_kasi_pemerintahan||""}),a.jsx("input",{type:"hidden",name:"jabatan_kasi_pemerintahan",value:s.jabatan_kasi_pemerintahan||""}),a.jsx("input",{type:"hidden",name:"nip_administrasi_kecamatan",value:s.nip_administrasi_kecamatan||""}),a.jsx("input",{type:"hidden",name:"jabatan_administrasi_kecamatan",value:s.jabatan_administrasi_kecamatan||""})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(N,{className:"text-slate-700 font-medium",children:"Status"}),a.jsxs(V,{value:s.status,onValueChange:e=>n("status",e),children:[a.jsx(W,{className:"border-blue-500 border-2",children:a.jsx(Q,{placeholder:"Pilih status"})}),a.jsxs(Z,{children:[a.jsx(C,{value:"Proses",children:"Proses"}),a.jsx(C,{value:"Selesai",children:"Selesai"}),a.jsx(C,{value:"Ditolak",children:"Ditolak"})]})]})]}),a.jsxs("div",{className:"flex justify-between pt-6 border-t border-slate-200",children:[a.jsxs(f,{type:"button",onClick:()=>r("penerima"),className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white hover:brightness-110 px-8",children:[a.jsx(z,{className:"w-4 h-4 mr-2"}),"Kembali"]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("span",{className:"text-sm text-slate-500",children:[a.jsx("span",{className:"font-medium",children:"Step 4 of 4:"})," Data Dokumen"]}),a.jsx(f,{type:"submit",disabled:i,className:"bg-gradient-to-b from-slate-900 via-slate-800 to-blue-900 text-white hover:brightness-110 px-8",children:i?a.jsxs(a.Fragment,{children:[a.jsx(Pa,{className:"w-4 h-4 mr-2 animate-spin"}),"Menyimpan..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Sa,{className:"w-4 h-4 mr-2"}),"Simpan Data"]})})]})]})]})]})})]})}),S&&a.jsx("div",{className:"fixed inset-0 z-[100] bg-black/50 flex items-center justify-center p-4",onClick:()=>T(!1),children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-7xl max-h-[98vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[a.jsx("div",{className:"p-6 border-b",children:a.jsxs("h2",{className:"flex items-center gap-2 text-xl font-semibold",children:[a.jsx(y,{className:"w-5 h-5 text-blue-600"}),"Pilih Lokasi Tanah di Peta"]})}),a.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"calc(98vh - 80px)"},children:a.jsx(Oa,{initialPosition:s.latitude&&s.longitude?[Number(s.latitude),Number(s.longitude)]:[-.7861746,119.8689641],initialPolygon:s.polygon_coords,initialMode:s.location_type||"marker",existingTanahData:(p||[]).filter(e=>e?.id!==t?.id),onSelectLocation:e=>{L(l=>({...l,latitude:e.latitude,longitude:e.longitude,location_type:e.type||"marker",polygon_coords:e.polygon||null}))},onClose:()=>T(!1)})})]})}),a.jsx(Fa,{open:H,onOpenChange:Y,children:a.jsxs(Ea,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[a.jsx(Ia,{children:a.jsx(Ua,{children:"Contoh Asal Usul Tanah"})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Ta,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),a.jsx(P,{placeholder:"Cari asal usul...",value:la,onChange:e=>{pa(e.target.value),aa(1)},className:"pl-10"})]}),a.jsx("div",{className:"space-y-2",children:(()=>{const l=[...new Set(p.filter(_=>_.asal_usul&&_.asal_usul.trim()!=="").map(_=>_.asal_usul.trim()))].filter(_=>_.toLowerCase().includes(la.toLowerCase())),o=Math.ceil(l.length/ea),h=(J-1)*ea,v=l.slice(h,h+ea);return v.length===0?a.jsx("div",{className:"text-center py-8 text-slate-500",children:"Tidak ada data asal usul"}):a.jsxs(a.Fragment,{children:[v.map((_,fa)=>a.jsx("div",{className:"p-3 border border-slate-200 rounded-lg hover:bg-slate-50 cursor-pointer transition-colors",onClick:()=>{n("asal_usul",_),Y(!1)},children:a.jsx("p",{className:"text-sm text-slate-700",children:_})},fa)),o>1&&a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[a.jsx(f,{variant:"outline",size:"sm",onClick:()=>aa(_=>Math.max(1,_-1)),disabled:J===1,children:"Sebelumnya"}),a.jsxs("span",{className:"text-sm text-slate-600",children:["Halaman ",J," dari ",o]}),a.jsx(f,{variant:"outline",size:"sm",onClick:()=>aa(_=>Math.min(o,_+1)),disabled:J===o,children:"Selanjutnya"})]})]})})()})]})]})})]})}function ie(){const t=Da(),[m]=Ka(),i=m.get("id"),[b,p]=j.useState(null),d=Ba();j.useEffect(()=>{const r=localStorage.getItem("user");if(r)try{p(JSON.parse(r))}catch{p(null)}else p(null)},[]);const{data:k=[]}=da({queryKey:["tanah"],queryFn:async()=>{const{data:r,error:u}=await q.from("tanah").select("*");if(u)throw new Error(u.message);return r||[]},enabled:!!b}),{data:x=[]}=da({queryKey:["wilayah"],queryFn:async()=>{const{data:r,error:u}=await q.from("wilayah").select("*");if(u)throw new Error(u.message);return r||[]}}),g=i?k.find(r=>String(r.id)===String(i)):null,S=ha({mutationFn:async r=>{const u={...r,created_by:b?.username||b?.full_name||null},{error:D}=await q.from("tanah").insert([u]);if(D)throw new Error(D.message)},onSuccess:()=>{d.invalidateQueries(["tanah"]),G.success("Data tanah berhasil ditambahkan"),t("/datatanah")},onError:r=>{G.error("Gagal menyimpan data: "+(r.message||r))}}),T=ha({mutationFn:async({id:r,data:u})=>{const{id:D,...R}=u||{},$={...R,updated_by:b?.username||b?.full_name||null},{error:H}=await q.from("tanah").update($).eq("id",r);if(H)throw new Error(H.message)},onSuccess:()=>{d.invalidateQueries(["tanah"]),G.success("Data tanah berhasil diperbarui"),t("/datatanah")},onError:r=>{G.error("Gagal update data: "+(r.message||r))}}),w=r=>{g?T.mutate({id:g.id,data:r}):S.mutate(r)};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:g?"Edit Data Tanah":"Tambah Data Tanah Baru"}),a.jsx("p",{className:"text-slate-500 mt-1",children:g?"Perbarui informasi data tanah":"Tambahkan data tanah baru ke sistem"})]}),a.jsxs(f,{variant:"outline",onClick:()=>t("/datatanah"),children:[a.jsx(Aa,{className:"w-4 h-4 mr-2"}),"Kembali"]})]}),a.jsx(K,{className:"border-0 shadow-md",children:a.jsx(B,{className:"p-6",children:a.jsx(Ja,{tanah:g,onSubmit:w,isLoading:S.isPending||T.isPending,wilayahList:x,allTanahData:k})})})]})}export{ie as default};
//# sourceMappingURL=FormTanah-BmcGZce5.js.map
