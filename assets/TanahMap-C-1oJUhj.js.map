{"version":3,"file":"TanahMap-C-1oJUhj.js","sources":["../../Components/maps/TanahMap.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { LeafletContext } from './LeafletContext';\r\nimport { MapContainer, TileLayer, Marker, Polygon, Popup, useMap } from 'react-leaflet';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Eye, EyeOff, Shapes, ShapesIcon } from 'lucide-react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport { createCircleIcon } from './utils';\r\nimport { getPolygonColors } from './utils';\r\nimport { createPageUrl } from '@/utils';\r\n\r\nfunction MapController({ center, zoom }) {\r\n  const map = useMap();\r\n  // Hanya recenter jika center/zoom berubah, bukan saat showMarkers berubah\r\n  useEffect(() => {\r\n    if (center) {\r\n      map.setView(center, zoom);\r\n    }\r\n    // eslint-disable-next-line\r\n  }, [JSON.stringify(center), zoom, map]);\r\n  return null;\r\n}\r\n\r\nfunction TanahMap({ tanahList, center, zoom, selectedId, mapType = 'hybrid', showMarkers = true, showPolygons = true }) {\r\n  // Jika ingin menggunakan context, gunakan useLeafletContext dari LeafletContext.jsx\r\n  const leafletCtx = {};\r\n  const mapCenter = center || [0.7929194, 119.8875111];\r\n  const mapZoom = zoom || 20;\r\n  const processedTanahList = tanahList.map(tanah => {\r\n    if (tanah.polygon_coords && typeof tanah.polygon_coords === 'string') {\r\n      try {\r\n        return { ...tanah, polygon_coords: JSON.parse(tanah.polygon_coords) };\r\n      } catch (e) {\r\n        console.error('Failed to parse polygon_coords for tanah', tanah.id, e);\r\n        return { ...tanah, polygon_coords: null };\r\n      }\r\n    }\r\n    return tanah;\r\n  });\r\n  let tileLayer;\r\n  if (mapType === 'street') {\r\n    tileLayer = {\r\n      url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\r\n      attribution: '© OpenStreetMap contributors',\r\n    };\r\n  } else if (mapType === 'hybrid') {\r\n    tileLayer = {\r\n      url: 'https://mt1.google.com/vt/lyrs=y,h&x={x}&y={y}&z={z}',\r\n      attribution: 'Map data ©2025 Google, Imagery ©2025 TerraMetrics',\r\n    };\r\n  } else {\r\n    tileLayer = {\r\n      url: 'https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}',\r\n      attribution: 'Map data ©2025 Google, Imagery ©2025 TerraMetrics',\r\n    };\r\n  }\r\n  return (\r\n    <LeafletContext.Provider value={leafletCtx}>\r\n      <Card className=\"overflow-hidden rounded-xl shadow-lg\">\r\n        <div className=\"relative\">\r\n          <MapContainer\r\n            center={mapCenter}\r\n            zoom={mapZoom}\r\n            style={{ height: '500px', width: '100%' }}\r\n            className=\"z-0\"\r\n          >\r\n            <MapController center={mapCenter} zoom={mapZoom} />\r\n            <TileLayer url={tileLayer.url} attribution={tileLayer.attribution} />\r\n            {processedTanahList.map((tanah) => {\r\n            if (!tanah.latitude || !tanah.longitude) return null;\r\n            const isSelected = selectedId && parseInt(tanah.id) === parseInt(selectedId);\r\n            const { color, borderColor } = getPolygonColors(tanah.status, isSelected);\r\n            const position = [tanah.latitude, tanah.longitude];\r\n            const hasPolygon = tanah.polygon_coords && Array.isArray(tanah.polygon_coords) && tanah.polygon_coords.length > 2;\r\n            let elements = [];\r\n            if (showPolygons && hasPolygon) {\r\n              elements.push(\r\n                <Polygon\r\n                  key={tanah.id}\r\n                  positions={tanah.polygon_coords}\r\n                  pathOptions={{\r\n                    color: borderColor,\r\n                    fillColor: color,\r\n                    fillOpacity: 0.3,\r\n                    weight: 2\r\n                  }}\r\n                >\r\n                  <Popup>\r\n                    <div className=\"min-w-[250px] p-2\">\r\n                      <div className=\"text-center space-y-2\">\r\n                        <p className=\"font-medium text-slate-800\">\r\n                          {tanah.nama_pemilik}\r\n                          {tanah.nama_penerima && (\r\n                            <> diserahkan kepada {tanah.nama_penerima}</>\r\n                          )}\r\n                          {tanah.atas_nama && (\r\n                            <> / {tanah.atas_nama}</>\r\n                          )}\r\n                        </p>\r\n                        <p className=\"text-sm text-slate-500\">\r\n                          {tanah.luas_meter % 1 === 0 ? Math.floor(tanah.luas_meter) : tanah.luas_meter.toString().replace('.', ',')} m²\r\n                        </p>\r\n                        <p className=\"text-xs text-slate-400\">\r\n                          {tanah.latitude}, {tanah.longitude}\r\n                        </p>\r\n                        <div className=\"flex justify-center py-2\">\r\n                          <img \r\n                            src={`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(`https://www.google.com/maps?q=${tanah.latitude},${tanah.longitude}`)}`}\r\n                            alt=\"QR Code\"\r\n                            className=\"w-32 h-32 border-2 border-slate-200 rounded\"\r\n                          />\r\n                        </div>\r\n                        <Badge variant={tanah.status === 'Selesai' ? 'default' : tanah.status === 'Ditolak' ? 'destructive' : 'secondary'}>\r\n                          {tanah.status || 'Proses'}\r\n                        </Badge>\r\n                      </div>\r\n                      <Link to={createPageUrl('DetailTanah') + `?id=${tanah.id}`}>\r\n                        <Button size=\"sm\" className=\"w-full mt-3 bg-blue-600 hover:bg-blue-700\">\r\n                          <Eye className=\"w-4 h-4 mr-2\" />\r\n                          Lihat Detail\r\n                        </Button>\r\n                      </Link>\r\n                    </div>\r\n                  </Popup>\r\n                </Polygon>\r\n              );\r\n            }\r\n            // Marker SELALU tampil jika tidak ada poligon, atau jika showMarkers aktif\r\n            if (!hasPolygon || showMarkers) {\r\n              elements.push(\r\n                <Marker\r\n                  key={tanah.id + '-marker'}\r\n                  position={position}\r\n                  icon={createCircleIcon(tanah.status, mapZoom)}\r\n                >\r\n                  <Popup>\r\n                    <div className=\"min-w-[250px] p-2\">\r\n                      <div className=\"text-center space-y-2\">\r\n                        <p className=\"font-medium text-slate-800\">\r\n                          {tanah.nama_pemilik}\r\n                          {tanah.nama_penerima && (\r\n                            <> diserahkan kepada {tanah.nama_penerima}</>\r\n                          )}\r\n                          {tanah.atas_nama && (\r\n                            <> / {tanah.atas_nama}</>\r\n                          )}\r\n                        </p>\r\n                        <p className=\"text-sm text-slate-500\">\r\n                          {tanah.luas_meter % 1 === 0 ? Math.floor(tanah.luas_meter) : tanah.luas_meter.toString().replace('.', ',')} m²\r\n                        </p>\r\n                        <p className=\"text-xs text-slate-400\">\r\n                          {tanah.latitude}, {tanah.longitude}\r\n                        </p>\r\n                        <div className=\"flex justify-center py-2\">\r\n                          <img \r\n                            src={`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(`https://www.google.com/maps?q=${tanah.latitude},${tanah.longitude}`)}`}\r\n                            alt=\"QR Code\"\r\n                            className=\"w-32 h-32 border-2 border-slate-200 rounded\"\r\n                          />\r\n                        </div>\r\n                        <Badge variant={tanah.status === 'Selesai' ? 'default' : tanah.status === 'Ditolak' ? 'destructive' : 'secondary'}>\r\n                          {tanah.status || 'Proses'}\r\n                        </Badge>\r\n                        <Link to={createPageUrl('DetailTanah') + `?id=${tanah.id}`}>\r\n                          <Button size=\"sm\" className=\"w-full mt-3 bg-blue-600 hover:bg-blue-700\">\r\n                            <Eye className=\"w-4 h-4 mr-2\" />\r\n                            Lihat Detail\r\n                          </Button>\r\n                        </Link>\r\n                      </div>\r\n                    </div>\r\n                  </Popup>\r\n                </Marker>\r\n              );\r\n            }\r\n            return elements.length > 0 ? elements : null;\r\n          })}\r\n          </MapContainer>\r\n        </div>\r\n      </Card>\r\n    </LeafletContext.Provider>\r\n  );\r\n}\r\n\r\nexport default TanahMap;\r\n"],"names":["MapController","center","zoom","map","useMap","useEffect","TanahMap","tanahList","selectedId","mapType","showMarkers","showPolygons","leafletCtx","mapCenter","mapZoom","processedTanahList","tanah","e","tileLayer","jsx","LeafletContext","Card","jsxs","MapContainer","TileLayer","isSelected","color","borderColor","getPolygonColors","position","hasPolygon","elements","Polygon","Popup","Fragment","Badge","Link","createPageUrl","Button","Eye","Marker","createCircleIcon"],"mappings":"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"}