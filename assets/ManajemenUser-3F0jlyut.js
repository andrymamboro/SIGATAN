import{r,D as X,v as H,G as U,j as e,ar as B,U as b,P as ee,H as ae,as as I,I as se,s as le,at as te,T as ne,Y as re,Z as f}from"./vendor-CDA6I53B.js";import{s as h}from"./db-CzWppX9X.js";import{C as m,a as u}from"./card-DKMhJA2Q.js";import{B as o}from"./index-yx-jgwg1.js";import{I as j}from"./input-CWJLU9W1.js";import{L as c}from"./label-wcoL3QN2.js";import{S,a as D,b as A,c as P,d as g}from"./select-DkHE2ADG.js";import{B as M}from"./badge-BNLm1yiM.js";import{D as O,a as V,b as Q,c as z}from"./dialog-DQrH_2W9.js";import{A as ie,a as ce,b as de,c as me,d as oe,e as xe,f as he,g as ue}from"./alert-dialog-DIAaR8u9.js";import"./leaflet-D651TNsF.js";import"./pdf-BL6BoWiN.js";function Se(){const[l,K]=r.useState(null),[E,N]=r.useState(null),[x,R]=r.useState(""),[G,d]=r.useState(!1),[i,w]=r.useState(null),[T,v]=r.useState(null),[t,n]=r.useState({username:"",no_hp:"",full_name:"",kecamatan:"",kelurahan:"",role:"user",password:""}),k=X();r.useEffect(()=>{const a=localStorage.getItem("user");if(a)try{N(JSON.parse(a))}catch{N(null)}else N(null)},[]);const{data:p=[],isLoading:je}=H({queryKey:["users"],queryFn:async()=>{const{data:a,error:s}=await h.from("users").select("*");if(s)throw new Error(s.message);return a||[]},enabled:!0}),{data:L=[]}=H({queryKey:["wilayah"],queryFn:async()=>{const{data:a,error:s}=await h.from("wilayah").select("*");if(s)throw new Error(s.message);return a||[]}}),y=U({mutationFn:async a=>{const{error:s}=await h.from("users").insert([a]);if(s)throw new Error(s.message)},onSuccess:()=>{k.invalidateQueries(["users"]),d(!1),_(),f.success("User berhasil ditambahkan")},onError:a=>{f.error("Gagal menambah user: "+(a.message||"Terjadi kesalahan"))}}),C=U({mutationFn:async({id:a,data:s})=>{const{error:F}=await h.from("users").update(s).eq("id",a);if(F)throw new Error(F.message)},onSuccess:()=>{k.invalidateQueries(["users"]),d(!1),w(null),_(),f.success("Data user berhasil diperbarui")}}),J=U({mutationFn:async a=>{const{error:s}=await h.from("users").delete().eq("id",a);if(s)throw new Error(s.message)},onSuccess:()=>{k.invalidateQueries(["users"]),v(null),f.success("User berhasil dihapus")}}),_=()=>{n({username:"",no_hp:"",full_name:"",kecamatan:"",kelurahan:"",role:"user",password:""})},Y=a=>{if(a.preventDefault(),i){const s={...t};(!s.password||s.password.trim()==="")&&delete s.password,C.mutate({id:i.id,data:s})}else{const s={...t,aktif:!0};y.mutate(s)}},Z=a=>{w(a),n({username:a.username||"",no_hp:a.no_hp||"",full_name:a.full_name||"",kecamatan:a.kecamatan||"",kelurahan:a.kelurahan||"",role:a.role||"user"}),d(!0)},$=[...new Set(L.map(a=>a.kecamatan))],W=t.kecamatan?[...new Set(L.filter(a=>a.kecamatan===t.kecamatan).map(a=>a.kelurahan))]:[],q=p.filter(a=>a.full_name?.toLowerCase().includes(x.toLowerCase())||a.username?.toLowerCase().includes(x.toLowerCase())||a.email?.toLowerCase().includes(x.toLowerCase())||a.no_hp?.includes(x));return E?.role!=="super_admin"?e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsxs(m,{className:"p-8 text-center",children:[e.jsx(B,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-800 mb-2",children:"Akses Ditolak"}),e.jsx("p",{className:"text-slate-600",children:"Hanya super admin yang dapat mengakses halaman ini"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-800 flex items-center gap-3",children:[e.jsx(b,{className:"w-8 h-8 text-blue-600"}),"Manajemen User"]}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Kelola pengguna sistem"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(o,{onClick:()=>{w(null),_(),d(!0)},className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Tambah User"]})})]}),e.jsx(m,{className:"border-0 shadow-md",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(j,{placeholder:"Cari nama, username, email, atau no. HP...",value:x,onChange:a=>R(a.target.value),className:"pl-10"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(m,{className:"border-0 shadow-lg bg-gradient-to-br from-blue-500 to-blue-600",children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100",children:"Total User"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:p.length})]}),e.jsx("div",{className:"p-3 rounded-xl bg-white/20",children:e.jsx(b,{className:"w-6 h-6 text-white"})})]})})}),e.jsx(m,{className:"border-0 shadow-lg bg-gradient-to-br from-purple-500 to-purple-600",children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-100",children:"Admin"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:p.filter(a=>a.role==="admin").length})]}),e.jsx("div",{className:"p-3 rounded-xl bg-white/20",children:e.jsx(B,{className:"w-6 h-6 text-white"})})]})})}),e.jsx(m,{className:"border-0 shadow-lg bg-gradient-to-br from-emerald-500 to-emerald-600",children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-emerald-100",children:"User Biasa"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:p.filter(a=>a.role==="user").length})]}),e.jsx("div",{className:"p-3 rounded-xl bg-white/20",children:e.jsx(I,{className:"w-6 h-6 text-white"})})]})})})]}),e.jsx(m,{className:"border-0 shadow-md",children:e.jsx(u,{className:"p-0",children:q.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(b,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-600",children:"Tidak ada user"}),e.jsx("p",{className:"text-slate-400 mt-1",children:"User belum ditambahkan ke sistem"})]}):e.jsx("div",{className:"divide-y divide-slate-100",children:e.jsx(se,{children:q.map((a,s)=>e.jsx(le.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:s*.02},className:"p-4 hover:bg-slate-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:a.full_name?.[0]||a.username?.[0]||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-slate-800 truncate",children:a.full_name||a.username}),e.jsxs(M,{className:a.role==="admin_kecamatan"?"bg-blue-100 text-blue-700":a.role==="admin_kelurahan"?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-700",children:[a.role==="admin_kecamatan"&&"Admin Kecamatan",a.role==="admin_kelurahan"&&"Admin Kelurahan",a.role!=="admin_kecamatan"&&a.role!=="admin_kelurahan"&&a.role]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-slate-500",children:[a.username&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3"}),a.username]}),a.no_hp&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),a.no_hp]}),a.kecamatan&&e.jsxs("span",{className:"text-slate-400",children:[a.kecamatan,a.kelurahan&&`, ${a.kelurahan}`]})]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>K(a),className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:[e.jsx(b,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>Z(a),className:"text-orange-600 border-orange-200 hover:bg-orange-50",children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),"Edit"]}),a.id!==E?.id&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>v(a.id),className:"text-red-600 border-red-200 hover:bg-red-50",children:e.jsx(re,{className:"w-4 h-4"})})]}),e.jsx(O,{open:!!l,onOpenChange:()=>K(null),children:e.jsxs(V,{className:"max-w-md",children:[e.jsx(Q,{children:e.jsx(z,{className:"text-xl",children:"Detail User"})}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white text-2xl font-bold shadow mb-2",children:l.full_name?.[0]||l.username?.[0]||"U"}),e.jsx("div",{className:"text-lg font-bold text-center",children:l.full_name||l.username}),e.jsxs(M,{className:l.role==="admin_kecamatan"?"bg-blue-100 text-blue-700":l.role==="admin_kelurahan"?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-700",children:[l.role==="admin_kecamatan"&&"Admin Kecamatan",l.role==="admin_kelurahan"&&"Admin Kelurahan",l.role!=="admin_kecamatan"&&l.role!=="admin_kelurahan"&&l.role]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Username"}),e.jsx("span",{className:"font-semibold",children:l.username||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Email"}),e.jsx("span",{className:"font-semibold",children:l.email||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"No. HP"}),e.jsx("span",{className:"font-semibold",children:l.no_hp||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Kecamatan"}),e.jsx("span",{className:"font-semibold",children:l.kecamatan||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Kelurahan"}),e.jsx("span",{className:"font-semibold",children:l.kelurahan||"-"})]})]})]})]})})]})},a.id))})})})}),e.jsx(O,{open:G,onOpenChange:d,children:e.jsxs(V,{className:"max-w-lg",children:[e.jsx(Q,{children:e.jsx(z,{className:"text-xl",children:i?"Edit Data User":"Tambah User Baru"})}),e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-blue-700 font-bold",children:"Nama Lengkap *"}),e.jsx(j,{value:t.full_name,onChange:a=>n({...t,full_name:a.target.value}),placeholder:"Nama lengkap",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-blue-700 font-bold",children:"Username *"}),e.jsx(j,{value:t.username,onChange:a=>n({...t,username:a.target.value}),placeholder:"Username",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-blue-700 font-bold",children:i?"Password (kosongkan jika tidak diubah)":"Password *"}),e.jsx(j,{type:"password",value:t.password||"",onChange:a=>n({...t,password:a.target.value}),placeholder:"********",required:!i,className:"tracking-widest font-mono"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-blue-700 font-bold",children:"No. HP"}),e.jsx(j,{value:t.no_hp,onChange:a=>n({...t,no_hp:a.target.value}),placeholder:"08xxxxxxxxxx"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-blue-700 font-bold",children:"Kecamatan"}),e.jsxs(S,{value:t.kecamatan,onValueChange:a=>n({...t,kecamatan:a,kelurahan:""}),children:[e.jsx(D,{className:"border-2 border-blue-400 rounded-lg focus:ring-2 focus:ring-blue-300",children:e.jsx(A,{placeholder:"Pilih Kecamatan"})}),e.jsx(P,{children:$.map(a=>e.jsx(g,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-blue-700 font-bold",children:"Kelurahan"}),e.jsxs(S,{value:t.kelurahan,onValueChange:a=>n({...t,kelurahan:a}),children:[e.jsx(D,{className:"border-2 border-blue-400 rounded-lg focus:ring-2 focus:ring-blue-300",children:e.jsx(A,{placeholder:"Pilih Kelurahan"})}),e.jsx(P,{children:W.map(a=>e.jsx(g,{value:a,children:a},a))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-blue-700 font-bold",children:"Role *"}),e.jsxs(S,{value:t.role,onValueChange:a=>n({...t,role:a}),children:[e.jsx(D,{className:"border-2 border-blue-400 rounded-lg focus:ring-2 focus:ring-blue-300",children:e.jsx(A,{placeholder:"Pilih Role"})}),e.jsxs(P,{children:["// ...existing code...",e.jsx(g,{value:"admin_kecamatan",children:"Admin Kecamatan"}),e.jsx(g,{value:"admin_kelurahan",children:"Admin Kelurahan"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Batal"}),e.jsx(o,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:C.isPending||y.isPending,children:C.isPending||y.isPending?"Menyimpan...":i?"Update":"Tambah"})]})]})]})}),e.jsx(ie,{open:!!T,onOpenChange:()=>v(null),children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:"Hapus User?"}),e.jsx(oe,{children:"Tindakan ini tidak dapat dibatalkan. User akan dihapus secara permanen dari sistem."})]}),e.jsxs(xe,{children:[e.jsx(he,{children:"Batal"}),e.jsx(ue,{onClick:()=>J.mutate(T),className:"bg-red-600 hover:bg-red-700",children:"Hapus"})]})]})})]})}export{Se as default};
//# sourceMappingURL=ManajemenUser-3F0jlyut.js.map
