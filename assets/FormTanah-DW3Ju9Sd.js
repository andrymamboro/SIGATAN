const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/card-B0dQSrhg.js","assets/vendor-B-UrjPD3.js","assets/vendor-CFel97hn.css","assets/index-orbV01hg.js","assets/pdf-Dy1nE1k0.js","assets/index-_B1iIQuT.css","assets/TanahForm-BRT_B6UT.js","assets/dialog-Kmfr7p_t.js","assets/label-pyXmey3a.js","assets/select-x77qZnkP.js","assets/tabs-Bllfj2Ej.js","assets/badge-CoCHSYKu.js","assets/db-BLqj6fe8.js"])))=>i.map(i=>d[i]);
import{_ as a}from"./pdf-Dy1nE1k0.js";import{k as e,ae as t,r as s,y as n,s as r,A as i,j as d,W as l,V as o}from"./vendor-B-UrjPD3.js";import{s as c}from"./db-BLqj6fe8.js";const m=s.lazy(()=>a(()=>import("./card-B0dQSrhg.js"),__vite__mapDeps([0,1,2,3,4,5])).then(a=>({default:a.Card}))),h=s.lazy(()=>a(()=>import("./card-B0dQSrhg.js"),__vite__mapDeps([0,1,2,3,4,5])).then(a=>({default:a.CardContent}))),u=s.lazy(()=>a(()=>import("./index-orbV01hg.js").then(a=>a.d),__vite__mapDeps([3,1,2,4,5])).then(a=>({default:a.Button}))),f=s.lazy(()=>a(()=>import("./TanahForm-BRT_B6UT.js"),__vite__mapDeps([6,4,1,2,7,3,5,8,9,0,10,11,12])));function x(){const a=e(),[x]=t(),j=x.get("id"),[p,y]=s.useState(void 0),_=n();s.useEffect(()=>{const a=localStorage.getItem("user");if(a)try{y(JSON.parse(a))}catch(e){y(null)}else y(null)},[]);const{data:w=[],isLoading:g,isFetching:b}=r({queryKey:["tanah"],queryFn:async()=>{const{data:a,error:e}=await c.from("tanah").select("*");if(e)throw new Error(e.message);return a||[]},enabled:void 0!==p&&!!p}),{data:E=[]}=r({queryKey:["wilayah"],queryFn:async()=>{const{data:a,error:e}=await c.from("wilayah").select("*");if(e)throw new Error(e.message);return a||[]}}),v=j?w.find(a=>String(a.id)===String(j)):null,N=i({mutationFn:async a=>{const e={...a,created_by:p?.username||p?.full_name||null},{error:t}=await c.from("tanah").insert([e]);if(t)throw new Error(t.message)},onSuccess:()=>{_.invalidateQueries(["tanah"]),o.success("Data tanah berhasil ditambahkan"),a("/datatanah")},onError:a=>{o.error("Gagal menyimpan data: "+(a.message||a))}}),S=i({mutationFn:async({id:a,data:e})=>{const{id:t,...s}=e||{},n={...s,updated_by:p?.username||p?.full_name||null},{error:r}=await c.from("tanah").update(n).eq("id",a);if(r)throw new Error(r.message)},onSuccess:()=>{_.invalidateQueries(["tanah"]),o.success("Data tanah berhasil diperbarui"),a("/datatanah")},onError:a=>{o.error("Gagal update data: "+(a.message||a))}});return void 0===p?d.jsx("div",{className:"flex items-center justify-center min-h-[200px]",children:d.jsx("span",{className:"text-white",children:"Memuat user..."})}):j&&g||j&&!v&&!g&&w.length>0?d.jsx("div",{className:"flex items-center justify-center min-h-[200px]",children:d.jsx("span",{className:"text-white",children:"Memuat data tanah..."})}):d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-1xl font-bold text-white",children:v?"Edit Data Tanah":"Tambah Data Tanah Baru"}),d.jsx("p",{className:"text-white text-sm mt-0",children:v?"Perbarui informasi data tanah":"Tambahkan data tanah baru ke sistem"})]}),d.jsx(s.Suspense,{fallback:d.jsx("span",{children:"..."}),children:d.jsxs(u,{className:"text-white",variant:"outline",onClick:()=>a("/datatanah"),children:[d.jsx(l,{className:"w-4 h-4 mr-2"}),"Kembali"]})})]}),d.jsx(s.Suspense,{fallback:d.jsx("div",{children:"Memuat form..."}),children:d.jsx(m,{className:"border-0 shadow-md",children:d.jsx(h,{className:"p-6",children:d.jsx(f,{tanah:v,onSubmit:a=>{v?S.mutate({id:v.id,data:a}):N.mutate(a)},isLoading:N.isPending||S.isPending,wilayahList:E,allTanahData:w,mapCenter:v&&v.latitude&&v.longitude?[v.latitude,v.longitude]:void 0,mapZoom:v?18:void 0})})})})]})}export{x as default};
//# sourceMappingURL=FormTanah-DW3Ju9Sd.js.map
