import{r as a,j as e,H as l,K as s,C as t,aH as r}from"./vendor-k34wZweL.js";import{s as n}from"./db-JbIjIInw.js";import{I as i,D as d,a as c,b as m,c as o}from"./dialog-DUqBavK5.js";import{B as h}from"./index-DXIltddd.js";import"./pdf-Bn9KpTQO.js";function x(){const[x,u]=a.useState([]),[j,b]=a.useState(""),[k,p]=a.useState(1),w=x.filter(a=>a.kecamatan?.toLowerCase().includes(j.toLowerCase())||a.kelurahan?.toLowerCase().includes(j.toLowerCase())||(a.kode_wilayah||"").toLowerCase().includes(j.toLowerCase())),y=Math.ceil(w.length/5)||1,f=w.slice(5*(k-1),5*k),[g,N]=a.useState(!0),[v,_]=a.useState(null),[C,K]=a.useState(!1),[S,L]=a.useState(null),[W,q]=a.useState({kecamatan:"",kelurahan:"",kode_wilayah:"",alamat_kantor_kecamatan:"",alamat_kantor_kelurahan:""}),[A,M]=a.useState(!1),[z,D]=a.useState(null);a.useEffect(()=>{C?S&&q({kecamatan:S.kecamatan||"",kelurahan:S.kelurahan||"",kode_wilayah:S.kode_wilayah||"",alamat_kantor_kecamatan:S.alamat_kantor_kecamatan||"",alamat_kantor_kelurahan:S.alamat_kantor_kelurahan||""}):(q({kecamatan:"",kelurahan:"",kode_wilayah:""}),L(null))},[C,S]);return a.useEffect(()=>{(async()=>{N(!0);const{data:a,error:e}=await n.from("wilayah").select("*").order("kecamatan",{ascending:!0});e?_(e.message):u(a||[]),N(!1)})()},[]),e.jsxs("div",{className:"p-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 text-white",children:"Data Wilayah"}),g&&e.jsx("p",{children:"Memuat data wilayah..."}),v&&e.jsxs("p",{className:"text-red-500",children:["Gagal memuat data: ",v]}),!g&&!v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsx(h,{onClick:()=>K(!0),className:"bg-blue-600",children:"Tambah Wilayah"}),e.jsx("div",{className:"flex-1 flex justify-end",children:e.jsx(i,{type:"text",placeholder:"Cari kecamatan, kelurahan, kode...",value:j,onChange:a=>{b(a.target.value),p(1)},className:"w-full md:w-64"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border border-slate-300 bg-white",children:[e.jsx("thead",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-blue-900 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border",children:"No"}),e.jsx("th",{className:"px-4 py-2 border",children:"Kecamatan"}),e.jsx("th",{className:"px-4 py-2 border",children:"Kelurahan"}),e.jsx("th",{className:"px-4 py-2 border",children:"Kode Wilayah"}),e.jsx("th",{className:"px-4 py-2 border",children:"Alamat Kantor Kecamatan"}),e.jsx("th",{className:"px-4 py-2 border",children:"Alamat Kantor Kelurahan"}),e.jsx("th",{className:"px-4 py-2 border text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:0===f.length?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4 text-slate-400",children:"Tidak ada data"})}):f.map((a,t)=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-2 border text-center",children:5*(k-1)+t+1}),e.jsx("td",{className:"px-4 py-2 border",children:a.kecamatan}),e.jsx("td",{className:"px-4 py-2 border",children:a.kelurahan}),e.jsx("td",{className:"px-4 py-2 border",children:a.kode_wilayah||"-"}),e.jsx("td",{className:"px-4 py-2 border",children:a.alamat_kantor_kecamatan||"-"}),e.jsx("td",{className:"px-4 py-2 border",children:a.alamat_kantor_kelurahan||"-"}),e.jsx("td",{className:"px-4 py-2 border text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>{L(a),K(!0)},"aria-label":"Edit",children:e.jsx(l,{className:"w-5 h-5 text-blue-600"})}),e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>(async a=>{if(!window.confirm("Yakin ingin menghapus data wilayah ini?"))return;const{error:e}=await n.from("wilayah").delete().eq("id",a);e?alert("Gagal hapus: "+e.message):(u(x.filter(e=>e.id!==a)),D(null))})(a.id),"aria-label":"Delete",children:e.jsx(s,{className:"w-5 h-5 text-red-600"})})]})})]},a.id||t))})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("span",{className:"text-sm text-white",children:["Halaman ",k," dari ",y]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"icon",variant:"outline",className:"bg-blue-500",onClick:()=>p(a=>Math.max(1,a-1)),disabled:1===k,"aria-label":"Sebelumnya",children:e.jsx(t,{className:"w-5 h-5 text-white"})}),e.jsx(h,{size:"icon",variant:"outline",className:"bg-blue-500",onClick:()=>p(a=>Math.min(y,a+1)),disabled:k===y,"aria-label":"Berikutnya",children:e.jsx(r,{className:"w-5 h-5 text-white "})})]})]}),e.jsx(d,{open:C,onOpenChange:K,children:e.jsxs(c,{className:"max-w-md bg-gray-100",children:[e.jsx(m,{children:e.jsx(o,{children:S?"Edit Wilayah":"Tambah Wilayah"})}),e.jsxs("form",{onSubmit:async a=>{if(a.preventDefault(),M(!0),S){const{error:a}=await n.from("wilayah").update(W).eq("id",S.id);a?alert("Gagal update: "+a.message):(u(x.map(a=>a.id===S.id?{...a,...W}:a)),K(!1))}else{const{data:a,error:e}=await n.from("wilayah").insert([W]).select();!e&&a&&a[0]?(u([...x,a[0]]),K(!1)):alert("Gagal tambah: "+(e?.message||""))}M(!1)},className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kecamatan"}),e.jsx(i,{value:W.kecamatan,onChange:a=>q({...W,kecamatan:a.target.value}),required:!0,autoFocus:!0,disabled:!("super_admin"!==window?.user?.role)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kelurahan"}),e.jsx(i,{value:W.kelurahan,onChange:a=>q({...W,kelurahan:a.target.value}),required:!0,disabled:!("super_admin"!==window?.user?.role)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kode Wilayah"}),e.jsx(i,{value:W.kode_wilayah,onChange:a=>q({...W,kode_wilayah:a.target.value}),required:!0,disabled:!("super_admin"!==window?.user?.role)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 text-blue-900 font-weight-bold",children:["Alamat Kantor Kecamatan ",W.kecamatan]}),e.jsx(i,{value:W.alamat_kantor_kecamatan,onChange:a=>q({...W,alamat_kantor_kecamatan:a.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 text-blue-900 font-weight-bold",children:["Alamat Kantor Kelurahan ",W.kelurahan]}),e.jsx(i,{value:W.alamat_kantor_kelurahan,onChange:a=>q({...W,alamat_kantor_kelurahan:a.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>K(!1),children:"Batal"}),e.jsx(h,{type:"submit",className:"bg-blue-600",disabled:A,children:A?"Menyimpan...":"Simpan"})]})]})]})})]})]})}export{x as default};
//# sourceMappingURL=Wilayah-BitmoLX3.js.map
