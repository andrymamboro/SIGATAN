import{r as n,D as R,v as F,G as P,j as e,U as I,P as W,H as Y,I as Z,s as X,ap as $,T as ee,Y as ae,Z as S}from"./vendor-BKp2tr96.js";import{s as r}from"./db-DOO1oGDP.js";import{C as K,a as E}from"./card-tNNNiwYM.js";import{B as o}from"./index-C5rwQ5l5.js";import{I as h}from"./input-yVzg1dOJ.js";import{L as d}from"./label-CJowGj76.js";import{S as u,a as p,b as j,c as g,d as m}from"./select-DjR4LwCT.js";import{B as L}from"./badge-DBr3DEm2.js";import{D as se,a as te,b as le,c as ne}from"./dialog-BPgVm2Ic.js";import{A as re,a as ie,b as ce,c as de,d as oe,e as me,f as xe,g as he}from"./alert-dialog-Ccw6dliS.js";import"./leaflet-C2x5yPDR.js";import"./pdf-DglC5ngP.js";const B=["Camat","Lurah","Kasi Pemerintahan","Staf Administrasi Kecamatan"];function De(){const[ue,q]=n.useState(null),[x,J]=n.useState(""),[f,U]=n.useState("all"),[O,i]=n.useState(!1),[b,N]=n.useState(null),[D,w]=n.useState(null),[t,l]=n.useState({kecamatan:"",kelurahan:"",nama:"",jabatan:"",nip:"",selaku:"",aktif:!0}),k=R();n.useEffect(()=>{(async()=>{const{data:{user:s}}=await r.auth.getUser();if(s){const{data:c}=await r.from("users").select("*").eq("auth_id",s.id).single();q(c)}})()},[]);const{data:H=[],isLoading:pe}=F({queryKey:["pejabat"],queryFn:async()=>{const{data:a,error:s}=await r.from("pejabat").select("*");if(s)throw new Error(s.message);return a||[]}}),{data:A=[]}=F({queryKey:["wilayah"],queryFn:async()=>{const{data:a,error:s}=await r.from("wilayah").select("*");if(s)throw new Error(s.message);return a||[]}}),v=P({mutationFn:async a=>{const{error:s}=await r.from("pejabat").insert([a]);if(s)throw new Error(s.message)},onSuccess:()=>{k.invalidateQueries(["pejabat"]),i(!1),C(),S.success("Data pejabat berhasil ditambahkan")}}),y=P({mutationFn:async({id:a,data:s})=>{const{error:c}=await r.from("pejabat").update(s).eq("id",a);if(c)throw new Error(c.message)},onSuccess:()=>{k.invalidateQueries(["pejabat"]),i(!1),N(null),C(),S.success("Data pejabat berhasil diperbarui")}}),M=P({mutationFn:async a=>{const{error:s}=await r.from("pejabat").delete().eq("id",a);if(s)throw new Error(s.message)},onSuccess:()=>{k.invalidateQueries(["pejabat"]),w(null),S.success("Data pejabat berhasil dihapus")}}),C=()=>{l({kecamatan:"",kelurahan:"",nama:"",jabatan:"",nip:"",selaku:"",aktif:!0})},Q=a=>{a.preventDefault(),b?y.mutate({id:b.id,data:t}):v.mutate(t)},V=a=>{N(a),l({kecamatan:a.kecamatan||"",kelurahan:a.kelurahan||"",nama:a.nama||"",jabatan:a.jabatan||"",nip:a.nip||"",selaku:a.selaku||"",aktif:a.aktif!==!1}),i(!0)},z=[...new Set(A.map(a=>a.kecamatan))],_=t.kecamatan?[...new Set(A.filter(a=>a.kecamatan===t.kecamatan).map(a=>a.kelurahan))]:[],T=H.filter(a=>{const s=a.nama?.toLowerCase().includes(x.toLowerCase())||a.nip?.includes(x)||a.kecamatan?.toLowerCase().includes(x.toLowerCase()),c=f==="all"||a.jabatan===f;return s&&c}),G={Camat:"bg-purple-100 text-purple-700",Lurah:"bg-blue-100 text-blue-700","Kasi Pemerintahan":"bg-emerald-100 text-emerald-700","Staf Administrasi Kecamatan":"bg-orange-100 text-orange-700"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-800 flex items-center gap-3",children:[e.jsx(I,{className:"w-8 h-8 text-blue-600"}),"Data Pejabat"]}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Kelola data pejabat penanda tangan"})]}),e.jsxs(o,{onClick:()=>{N(null),C(),i(!0)},className:"bg-blue-600 hover:bg-blue-900 text-white",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Tambah Pejabat"]})]}),e.jsx(K,{className:"border-0 shadow-md",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(h,{placeholder:"Cari nama, NIP, atau kecamatan...",value:x,onChange:a=>J(a.target.value),className:"pl-10"})]}),e.jsxs(u,{value:f,onValueChange:U,children:[e.jsx(p,{className:"w-full md:w-64",children:e.jsx(j,{placeholder:"Filter Jabatan"})}),e.jsxs(g,{children:[e.jsx(m,{value:"all",children:"Semua Jabatan"}),B.map(a=>e.jsx(m,{value:a,children:a},a))]})]})]})})}),e.jsx(K,{className:"border-0 shadow-lg",children:e.jsx(E,{className:"p-0",children:T.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(I,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-600",children:"Belum ada data pejabat"}),e.jsx("p",{className:"text-slate-400 mt-1",children:'Klik tombol "Tambah Pejabat" untuk menambahkan data baru'})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-slate-50 to-slate-100 border-b-2 border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"No"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Nama & NIP"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Jabatan"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Wilayah"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Selaku"}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Aksi"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-slate-100",children:e.jsx(Z,{children:T.map((a,s)=>e.jsxs(X.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:s*.03},className:"hover:bg-slate-50 transition-colors duration-150",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-600",children:s+1}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-md flex-shrink-0",children:e.jsx("span",{className:"text-white text-sm font-bold",children:a.nama?.charAt(0).toUpperCase()||"P"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:a.nama}),e.jsxs("p",{className:"text-xs text-slate-500",children:["NIP: ",a.nip||"-"]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(L,{className:G[a.jabatan]||"bg-slate-100 text-slate-700",children:a.jabatan})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-slate-600",children:[e.jsx("p",{className:"font-medium",children:a.kecamatan}),a.kelurahan&&e.jsx("p",{className:"text-slate-500",children:a.kelurahan})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:a.selaku||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx(L,{className:a.aktif!==!1?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200",children:a.aktif!==!1?"Aktif":"Non-aktif"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>V(a),className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>w(a.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(ae,{className:"w-4 h-4"})})]})})]},a.id))})})]})})})}),e.jsx(se,{open:O,onOpenChange:i,children:e.jsxs(te,{className:"max-w-lg",children:[e.jsx(le,{children:e.jsx(ne,{className:"text-xl",children:b?"Edit Data Pejabat":"Tambah Pejabat Baru"})}),e.jsxs("form",{onSubmit:Q,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Kecamatan *"}),e.jsxs(u,{value:t.kecamatan,onValueChange:a=>l({...t,kecamatan:a,kelurahan:""}),children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Pilih Kecamatan"})}),e.jsx(g,{children:z.map(a=>e.jsx(m,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Kelurahan"}),e.jsxs(u,{value:t.kelurahan,onValueChange:a=>l({...t,kelurahan:a}),children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Pilih Kelurahan"})}),e.jsx(g,{children:_.map(a=>e.jsx(m,{value:a,children:a},a))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Nama Pejabat *"}),e.jsx(h,{value:t.nama,onChange:a=>l({...t,nama:a.target.value}),placeholder:"Nama lengkap",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Jabatan *"}),e.jsxs(u,{value:t.jabatan,onValueChange:a=>l({...t,jabatan:a}),children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Pilih Jabatan"})}),e.jsx(g,{children:B.map(a=>e.jsx(m,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"NIP"}),e.jsx(h,{value:t.nip,onChange:a=>l({...t,nip:a.target.value}),placeholder:"Nomor Induk Pegawai"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Selaku"}),e.jsx(h,{value:t.selaku,onChange:a=>l({...t,selaku:a.target.value}),placeholder:"Contoh: Pengelola Data Pertanahan"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Batal"}),e.jsx(o,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:v.isPending||y.isPending,children:v.isPending||y.isPending?"Menyimpan...":"Simpan"})]})]})]})}),e.jsx(re,{open:!!D,onOpenChange:()=>w(null),children:e.jsxs(ie,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Hapus Data Pejabat?"}),e.jsx(oe,{children:"Tindakan ini tidak dapat dibatalkan. Data pejabat akan dihapus secara permanen."})]}),e.jsxs(me,{children:[e.jsx(xe,{children:"Batal"}),e.jsx(he,{onClick:()=>M.mutate(D),className:"bg-red-600 hover:bg-red-700",children:"Hapus"})]})]})})]})}export{De as default};
//# sourceMappingURL=Pejabat-bTYB2jb8.js.map
