import{r as e,j as t,E as a,af as r,ag as l,ah as s,aJ as o,aK as n,ai as i,aj as d,ak as c,al as p,am as x,R as h,L as u,an as g,ao as m,ap as y,aq as b}from"./vendor-B-UrjPD3.js";import{u as j,a as f,g as w}from"./utils-BXcGCy28.js";import{B as k,c as N}from"./index-DFbN_dxx.js";import{B as S}from"./badge-B7sJnBCz.js";import"./db-BLqj6fe8.js";import"./authUser-CgjMIivx.js";import"./pdf-Dy1nE1k0.js";function v({center:u,zoom:g=15,isPicker:m=!1,selected:y,onMapClick:b,mapType:N="hybrid",mapCenter:S,mapZoom:v}){const[_,C]=e.useState(null),z=e.useRef(),R=e.useRef();e.useEffect(()=>{z.current&&S&&Array.isArray(S)&&z.current.setView(S,v||g)},[S,v]);const I=j(),{data:L=[],isLoading:M}=f(I),[T,P]=e.useState(!0),[$,O]=e.useState(!0),[B,F]=e.useState(!0),[U,D]=e.useState(!0),J=L,q=`https://mt1.google.com/vt/lyrs=${"hybrid"===N?"y,h":"y"}&x={x}&y={y}&z={z}`,K="hybrid"===N?"Map data ©2025 Google":"&copy; OpenStreetMap contributors",[W,E]=e.useState(null);return M?t.jsx("div",{style:{width:"100%",height:400,display:"flex",alignItems:"center",justifyContent:"center"},children:"Memuat data tanah..."}):t.jsx(t.Fragment,{children:t.jsxs("div",{style:{width:"100%",height:600,border:"2px solid #e2e8f0",borderRadius:8},children:[t.jsxs("div",{className:"absolute z-[1000] top-10 right-16 flex flex-row gap-2 bg-white bg-opacity-80 p-1 rounded shadow-lg",style:{marginRight:"35px",marginTop:"8px"},children:[t.jsx(k,{className:"border-2 border-white",size:"sm",variant:U?"default":"outline",onClick:()=>D(e=>!e),children:U?t.jsxs(t.Fragment,{children:[t.jsx(a,{className:"w-4 h-4 mr-1"})," Info"]}):t.jsxs(t.Fragment,{children:[t.jsx(r,{className:"w-4 h-4 mr-1"})," Info"]})}),t.jsx(k,{className:"border-2 border-white",size:"sm",variant:T?"default":"outline",onClick:()=>P(e=>!e),children:T?t.jsxs(t.Fragment,{children:[t.jsx(a,{className:"w-4 h-4 mr-1"})," Marker"]}):t.jsxs(t.Fragment,{children:[t.jsx(r,{className:"w-4 h-4 mr-1"})," Marker"]})})]}),t.jsxs(l,{center:S||u||[-.78961418,119.89162106],zoom:v||g,maxZoom:20,style:{width:"100%",height:"100%",borderRadius:8},ref:z,children:[t.jsx(s,{url:q,attribution:K,maxZoom:20}),t.jsx(o,{ref:R,children:t.jsx(n,{position:"topleft",onCreated:e=>{if(window._lastDrawEvent=e,b)if("marker"===e.layerType){const{lat:t,lng:a}=e.layer.getLatLng(),r={latitude:t.toString(),longitude:a.toString(),polygon_coords:null,type:"marker"};E({label:"Marker",data:r}),C(r),b(r)}else if("polygon"===e.layerType||"polyline"===e.layerType){let t=e.layer.getLatLngs();Array.isArray(t)&&Array.isArray(t[0])&&(t=t[0]);const a=t.map(e=>[Number(e.lat),Number(e.lng)]);let r=null,l=null;if(a.length>0){const e=a.reduce((e,[t,a])=>[e[0]+t,e[1]+a],[0,0]);r=e[0]/a.length,l=e[1]/a.length}const s={latitude:null!==r?r.toString():"",longitude:null!==l?l.toString():"",polygon_coords:a,type:e.layerType};E({label:"polygon"===e.layerType?"Polygon":"Polyline",data:s}),C(s),b(s)}else console.warn("handleCreated: layerType tidak dikenali",e.layerType,e);else console.warn("onMapClick prop tidak ada!")},featureGroup:R.current,draw:{marker:!0,polyline:!0,polygon:!0,circle:!1,rectangle:!1,circlemarker:!1}})}),m&&y&&y.latitude&&y.longitude&&t.jsx(i,{position:[y.latitude,y.longitude],children:t.jsxs(d,{children:["Lokasi dipilih: ",y.latitude,", ",y.longitude]})}),J.map((e,a)=>{const r=new URLSearchParams(window.location.search).get("id"),l=parseInt(e.id)===parseInt(r),s=e.latitude&&e.longitude&&T?t.jsxs(i,{position:[e.latitude,e.longitude],children:[t.jsx(d,{children:t.jsx(A,{tanah:e})}),U&&t.jsx(c,{direction:"top",offset:[0,-10],permanent:!0,children:t.jsx("span",{style:{background:l?"#f97316":"#fff",color:l?"#fff":"#000",fontWeight:"bold",borderRadius:6,border:"2px solid #fff",boxShadow:"0 2px 8px #0002",padding:"2px 8px",display:"inline-block"},children:e.nama_pemilik})})]},`marker-${a}`):null;let o=e.polygon_coords;if(o&&"string"==typeof o)try{o=JSON.parse(o)}catch{o=null}const{color:n,borderColor:u}=w(e.status),g=o&&Array.isArray(o)&&o.length>2?t.jsx(p,{positions:o,pathOptions:{color:u,fillColor:n},children:t.jsx(d,{children:t.jsxs("div",{children:[t.jsx("b",{children:"Koordinat Polygon:"}),t.jsx("pre",{style:{fontSize:12,margin:0},children:JSON.stringify(o,null,2)})]})})},`polygon-${a}`):null;let m=e.polyline_coords;if(m&&"string"==typeof m)try{m=JSON.parse(m)}catch{m=null}const y=m&&Array.isArray(m)&&m.length>1?t.jsx(x,{positions:o,color:n.borderColor,fillColor:n.color,fillOpacity:.5,children:t.jsx(d,{children:t.jsxs("div",{children:[t.jsx("b",{children:"Koordinat Polyline:"}),t.jsx("pre",{style:{fontSize:12,margin:0},children:JSON.stringify(m,null,2)})]})})},`polyline-${a}`):null;return t.jsxs(h.Fragment,{children:[s,g,y]},a)}),t.jsxs("div",{style:{position:"absolute",right:24,bottom:24,zIndex:9999,background:"rgba(255,255,255,0.10)",borderRadius:12,boxShadow:"0 2px 12px #0002",padding:16,minWidth:260,maxWidth:340,backdropFilter:"blur(2px)"},children:[t.jsxs("div",{style:{fontWeight:"bold",color:"#0c4a6e",marginBottom:8,fontSize:15},children:["Koordinat Pusat: ",W?.data?.latitude||"-",", ",W?.data?.longitude||"-"]}),t.jsxs("table",{style:{width:"100%",background:"transparent",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"rgba(255,255,255,0.25)"},children:[t.jsx("th",{style:{borderBottom:"1px solid #ddd",padding:"4px 8px",textAlign:"center"},children:"No"}),t.jsx("th",{style:{borderBottom:"1px solid #ddd",padding:"4px 8px",textAlign:"center"},children:"Lat"}),t.jsx("th",{style:{borderBottom:"1px solid #ddd",padding:"4px 8px",textAlign:"center"},children:"Long"})]})}),t.jsxs("tbody",{children:[(Array.isArray(W?.data?.polygon_coords)?W.data.polygon_coords:W?.data?.latitude&&W?.data?.longitude?[[Number(W.data.latitude),Number(W.data.longitude)]]:[]).map(([e,a],r)=>t.jsxs("tr",{style:{background:r%2==0?"rgba(255,255,255,0.15)":"transparent"},children:[t.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:r+1}),t.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:e}),t.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:a})]},r)),0===(Array.isArray(W?.data?.polygon_coords)?W.data.polygon_coords:W?.data?.latitude&&W?.data?.longitude?[[Number(W.data.latitude),Number(W.data.longitude)]]:[]).length&&t.jsx("tr",{children:t.jsx("td",{colSpan:3,style:{textAlign:"center",color:"#64748b",padding:8},children:"Belum ada koordinat"})})]})]})]})]})]})})}function A({tanah:r}){const l=r.luas_meter%1==0?Math.floor(r.luas_meter):r.luas_meter.toString().replace(".",",");return t.jsx(e.Suspense,{fallback:t.jsx("div",{children:"Memuat detail..."}),children:t.jsxs("div",{className:"min-w-[220px] max-w-[260px] bg-white rounded-xl shadow-lg p-4 text-center space-y-3 border border-gray-200",children:[t.jsxs("p",{className:"font-bold text-slate-800 text-base mb-1",children:[r.nama_pemilik,r.nama_penerima&&t.jsxs("span",{className:"block text-xs font-normal text-slate-500",children:["Penerima: ",r.nama_penerima]})]}),t.jsxs("div",{className:"bg-blue-50 py-1 rounded border border-blue-100 font-semibold text-blue-700 text-sm",children:[l," m²"]}),t.jsx("div",{className:"flex justify-center py-1",children:t.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(`https://www.google.com/maps?q=${r.latitude},${r.longitude}`)}`,alt:"QR",className:"w-16 h-16 border rounded shadow"})}),t.jsx(S,{variant:"Selesai"===r.status?"default":"Ditolak"===r.status?"destructive":"secondary",children:r.status||"Proses"}),t.jsx(u,{to:`${N("DetailTanah")}?id=${r.id}`,className:"block mt-2",children:t.jsxs(k,{size:"sm",className:"w-full bg-blue-600 hover:bg-blue-700",children:[t.jsx(a,{className:"w-4 h-4 mr-2"})," Detail"]})})]})})}delete g.Icon.Default.prototype._getIconUrl,g.Icon.Default.mergeOptions({iconRetinaUrl:b,iconUrl:y,shadowUrl:m});export{v as default};
//# sourceMappingURL=MapPicker-DjHxf7iU.js.map
