{"version":3,"file":"authUser-CgjMIivx.js","sources":["../../api/authUser.js"],"sourcesContent":["// authUser.js - Helper untuk login dan gabung data user Supabase Auth + tabel users\r\nimport { supabase } from './db';\r\n\r\n/**\r\n * Ambil user login (gabungan Supabase Auth dan tabel users)\r\n * @returns {Promise<object|null>} user gabungan atau null jika tidak login\r\n */\r\nexport async function getCurrentUser() {\r\n  // Ambil user dari Supabase Auth\r\n  const { data: { user: authUser } } = await supabase.auth.getUser();\r\n  if (!authUser) return null;\r\n\r\n  // Cari user di tabel users berdasarkan auth_id, uid, atau email\r\n  let userApp = null;\r\n\r\n  // 1. Cari berdasarkan auth_id\r\n  let { data } = await supabase\r\n    .from('users')\r\n    .select('*')\r\n    .eq('auth_id', authUser.id)\r\n    .single();\r\n  userApp = data;\r\n\r\n  // 2. Jika tidak ketemu, cari berdasarkan uid\r\n  if (!userApp) {\r\n    let { data } = await supabase\r\n      .from('users')\r\n      .select('*')\r\n      .eq('uid', authUser.id)\r\n      .single();\r\n    userApp = data;\r\n    // Jika ketemu, update auth_id\r\n    if (userApp && !userApp.auth_id) {\r\n      await supabase\r\n        .from('users')\r\n        .update({ auth_id: authUser.id })\r\n        .eq('id', userApp.id);\r\n    }\r\n  }\r\n\r\n  // 3. Jika tidak ketemu, cari berdasarkan email\r\n  if (!userApp && authUser.email) {\r\n    let { data } = await supabase\r\n      .from('users')\r\n      .select('*')\r\n      .eq('email', authUser.email)\r\n      .single();\r\n    userApp = data;\r\n    // Jika ketemu, update uid dan auth_id\r\n    if (userApp) {\r\n      await supabase\r\n        .from('users')\r\n        .update({ uid: authUser.id, auth_id: authUser.id })\r\n        .eq('id', userApp.id);\r\n    }\r\n  }\r\n\r\n  // Gabungkan data Auth dan Users jika ditemukan\r\n  return userApp ? { ...authUser, ...userApp } : null;\r\n}\r\n\r\n// Contoh penggunaan:\r\n// import { getCurrentUser } from '@/api/authUser';\r\n// const user = await getCurrentUser();\r\n"],"names":["async","getCurrentUser","data","user","authUser","supabase","auth","getUser","userApp","from","select","eq","id","single","auth_id","update","email","uid"],"mappings":"qCAOOA,eAAeC,IAEpB,MAAQC,MAAQC,KAAMC,UAAqBC,EAASC,KAAKC,UACzD,IAAKH,EAAU,OAAO,KAGtB,IAAII,EAAU,MAGVN,KAAEA,SAAeG,EAClBI,KAAK,SACLC,OAAO,KACPC,GAAG,UAAWP,EAASQ,IACvBC,SAIH,GAHAL,EAAUN,GAGLM,EAAS,CACZ,IAAMN,KAAAA,SAAeG,EAClBI,KAAK,SACLC,OAAO,KACPC,GAAG,MAAOP,EAASQ,IACnBC,SACHL,EAAUN,EAENM,IAAYA,EAAQM,eAChBT,EACHI,KAAK,SACLM,OAAO,CAAED,QAASV,EAASQ,KAC3BD,GAAG,KAAMH,EAAQI,GAExB,CAGA,IAAKJ,GAAWJ,EAASY,MAAO,CAC9B,IAAMd,KAAAA,SAAeG,EAClBI,KAAK,SACLC,OAAO,KACPC,GAAG,QAASP,EAASY,OACrBH,SACHL,EAAUN,EAENM,SACIH,EACHI,KAAK,SACLM,OAAO,CAAEE,IAAKb,EAASQ,GAAIE,QAASV,EAASQ,KAC7CD,GAAG,KAAMH,EAAQI,GAExB,CAGA,OAAOJ,EAAU,IAAKJ,KAAaI,GAAY,IACjD"}