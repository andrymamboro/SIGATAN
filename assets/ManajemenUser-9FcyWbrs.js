import{r as e,y as a,s,A as l,j as n,aw as r,U as t,P as i,D as c,ax as d,as as m,ar as o,ay as x,H as h,K as u,V as j}from"./vendor-B-UrjPD3.js";import{s as p}from"./db-BLqj6fe8.js";import{Card as b,CardContent as f}from"./card-Ci5zgrO5.js";import{B as N}from"./index-ygIEbxVB.js";import{I as g,D as w,a as v,b as k,c as y}from"./dialog-ugtOs35z.js";import{L as _}from"./label-CRXG18ek.js";import{S as C,a as U,b as K,c as S,d as P}from"./select-Bu1BEFMR.js";import{B as A}from"./badge-BmRak_I8.js";import{A as E,a as q,b as L,c as D,d as H,e as T,f as B,g as F}from"./alert-dialog-BXYcU8ux.js";import"./pdf-Dy1nE1k0.js";function V(){const[V,O]=e.useState(null),[z,Q]=e.useState(null),[I,M]=e.useState(""),[R,G]=e.useState(!1),[J,$]=e.useState(null),[W,X]=e.useState(null),[Y,Z]=e.useState({username:"",no_hp:"",full_name:"",kecamatan:"",kelurahan:"",role:"user",password:""}),ee=a();e.useEffect(()=>{const e=localStorage.getItem("user");if(e)try{Q(JSON.parse(e))}catch(a){Q(null)}else Q(null)},[]);const{data:ae=[],isLoading:se}=s({queryKey:["users"],queryFn:async()=>{const{data:e,error:a}=await p.from("users").select("*");if(a)throw new Error(a.message);return e||[]},enabled:!0}),{data:le=[]}=s({queryKey:["wilayah"],queryFn:async()=>{const{data:e,error:a}=await p.from("wilayah").select("*");if(a)throw new Error(a.message);return e||[]}}),ne=l({mutationFn:async e=>{const{error:a}=await p.from("users").insert([e]);if(a)throw new Error(a.message)},onSuccess:()=>{ee.invalidateQueries(["users"]),G(!1),ie(),j.success("User berhasil ditambahkan")},onError:e=>{j.error("Gagal menambah user: "+(e.message||"Terjadi kesalahan"))}}),re=l({mutationFn:async({id:e,data:a})=>{const{error:s}=await p.from("users").update(a).eq("id",e);if(s)throw new Error(s.message)},onSuccess:()=>{ee.invalidateQueries(["users"]),G(!1),$(null),ie(),j.success("Data user berhasil diperbarui")}}),te=l({mutationFn:async e=>{const{error:a}=await p.from("users").delete().eq("id",e);if(a)throw new Error(a.message)},onSuccess:()=>{ee.invalidateQueries(["users"]),X(null),j.success("User berhasil dihapus")}}),ie=()=>{Z({username:"",no_hp:"",full_name:"",kecamatan:"",kelurahan:"",role:"user",password:""})},ce=[...new Set(le.map(e=>e.kecamatan))],de=Y.kecamatan?[...new Set(le.filter(e=>e.kecamatan===Y.kecamatan).map(e=>e.kelurahan))]:[],me=ae.filter(e=>e.full_name?.toLowerCase().includes(I.toLowerCase())||e.username?.toLowerCase().includes(I.toLowerCase())||e.email?.toLowerCase().includes(I.toLowerCase())||e.no_hp?.includes(I));return"super_admin"!==z?.role?n.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:n.jsxs(b,{className:"p-8 text-center",children:[n.jsx(r,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),n.jsx("h2",{className:"text-xl font-semibold text-slate-800 mb-2",children:"Akses Ditolak"}),n.jsx("p",{className:"text-slate-600",children:"Hanya super admin yang dapat mengakses halaman ini"})]})}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[n.jsx(t,{className:"w-8 h-8 text-blue-600"}),"Manajemen User"]}),n.jsx("p",{className:"text-white mt-1",children:"Kelola pengguna sistem"})]}),n.jsx("div",{className:"flex gap-2",children:n.jsxs(N,{onClick:()=>{$(null),ie(),G(!0)},className:"bg-blue-600 hover:bg-blue-700",children:[n.jsx(i,{className:"w-4 h-4 mr-2"}),"Tambah User"]})})]}),n.jsx(b,{className:"border-0 shadow-md",children:n.jsx(f,{className:"p-4",children:n.jsxs("div",{className:"relative",children:[n.jsx(c,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),n.jsx(g,{placeholder:"Cari nama, username, email, atau no. HP...",value:I,onChange:e=>M(e.target.value),className:"pl-10"})]})})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsx(b,{className:"border-0 shadow-lg bg-gradient-to-br from-blue-500 to-blue-600",children:n.jsx(f,{className:"p-6",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-blue-100",children:"Total User"}),n.jsx("p",{className:"text-2xl font-bold text-white",children:ae.length})]}),n.jsx("div",{className:"p-3 rounded-xl bg-white/20",children:n.jsx(t,{className:"w-6 h-6 text-white"})})]})})}),n.jsx(b,{className:"border-0 shadow-lg bg-gradient-to-br from-purple-500 to-purple-600",children:n.jsx(f,{className:"p-6",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-purple-100",children:"Admin"}),n.jsx("p",{className:"text-2xl font-bold text-white",children:ae.filter(e=>"admin"===e.role).length})]}),n.jsx("div",{className:"p-3 rounded-xl bg-white/20",children:n.jsx(r,{className:"w-6 h-6 text-white"})})]})})}),n.jsx(b,{className:"border-0 shadow-lg bg-gradient-to-br from-emerald-500 to-emerald-600",children:n.jsx(f,{className:"p-6",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-emerald-100",children:"User Biasa"}),n.jsx("p",{className:"text-2xl font-bold text-white",children:ae.filter(e=>"user"===e.role).length})]}),n.jsx("div",{className:"p-3 rounded-xl bg-white/20",children:n.jsx(d,{className:"w-6 h-6 text-white"})})]})})})]}),n.jsx(b,{className:"border-0 shadow-md",children:n.jsx(f,{className:"p-0",children:0===me.length?n.jsxs("div",{className:"p-12 text-center",children:[n.jsx(t,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-slate-600",children:"Tidak ada user"}),n.jsx("p",{className:"text-slate-400 mt-1",children:"User belum ditambahkan ke sistem"})]}):n.jsx("div",{className:"divide-y divide-slate-100",children:n.jsx(m,{children:me.map((e,a)=>n.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.02*a},className:"p-4 hover:bg-slate-50 transition-colors",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:n.jsx("span",{className:"text-sm font-bold text-blue-600",children:e.full_name?.[0]||e.username?.[0]||"U"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("h3",{className:"font-semibold text-slate-800 truncate",children:e.full_name||e.username}),n.jsxs(A,{className:"admin_kecamatan"===e.role?"bg-blue-100 text-blue-700":"admin_kelurahan"===e.role?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-700",children:["admin_kecamatan"===e.role&&"Admin Kecamatan","admin_kelurahan"===e.role&&"Admin Kelurahan","admin_kecamatan"!==e.role&&"admin_kelurahan"!==e.role&&e.role]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-slate-500",children:[e.username&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(d,{className:"w-3 h-3"}),e.username]}),e.no_hp&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(x,{className:"w-3 h-3"}),e.no_hp]}),e.kecamatan&&n.jsxs("span",{className:"text-slate-400",children:[e.kecamatan,e.kelurahan&&`, ${e.kelurahan}`]})]})]})]}),n.jsxs("div",{className:"flex gap-2 ml-4",children:[n.jsxs(N,{variant:"outline",size:"sm",onClick:()=>O(e),className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:[n.jsx(t,{className:"w-4 h-4 mr-1"}),"View"]}),n.jsxs(N,{variant:"outline",size:"sm",onClick:()=>(e=>{$(e),Z({username:e.username||"",no_hp:e.no_hp||"",full_name:e.full_name||"",kecamatan:e.kecamatan||"",kelurahan:e.kelurahan||"",role:e.role||"user"}),G(!0)})(e),className:"text-orange-600 border-orange-200 hover:bg-orange-50",children:[n.jsx(h,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.id!==z?.id&&n.jsx(N,{variant:"outline",size:"sm",onClick:()=>X(e.id),className:"text-red-600 border-red-200 hover:bg-red-50",children:n.jsx(u,{className:"w-4 h-4"})})]}),n.jsx(w,{open:!!V,onOpenChange:()=>O(null),children:n.jsxs(v,{className:"max-w-md",children:[n.jsx(k,{children:n.jsx(y,{className:"text-xl",children:"Detail User"})}),V&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex flex-col items-center mb-4",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white text-2xl font-bold shadow mb-2",children:V.full_name?.[0]||V.username?.[0]||"U"}),n.jsx("div",{className:"text-lg font-bold text-center",children:V.full_name||V.username}),n.jsxs(A,{className:"admin_kecamatan"===V.role?"bg-blue-100 text-blue-700":"admin_kelurahan"===V.role?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-700",children:["admin_kecamatan"===V.role&&"Admin Kecamatan","admin_kelurahan"===V.role&&"Admin Kelurahan","admin_kecamatan"!==V.role&&"admin_kelurahan"!==V.role&&V.role]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-slate-500",children:"Username"}),n.jsx("span",{className:"font-semibold",children:V.username||"-"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-slate-500",children:"Email"}),n.jsx("span",{className:"font-semibold",children:V.email||"-"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-slate-500",children:"No. HP"}),n.jsx("span",{className:"font-semibold",children:V.no_hp||"-"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-slate-500",children:"Kecamatan"}),n.jsx("span",{className:"font-semibold",children:V.kecamatan||"-"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-slate-500",children:"Kelurahan"}),n.jsx("span",{className:"font-semibold",children:V.kelurahan||"-"})]})]})]})]})})]})},e.id))})})})}),n.jsx(w,{open:R,onOpenChange:G,children:n.jsxs(v,{className:"max-w-lg",children:[n.jsx(k,{children:n.jsx(y,{className:"text-xl",children:J?"Edit Data User":"Tambah User Baru"})}),n.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),J){const e={...Y};e.password&&""!==e.password.trim()||delete e.password,re.mutate({id:J.id,data:e})}else{const e={...Y,aktif:!0};ne.mutate(e)}},className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(_,{className:"text-blue-700 font-bold",children:"Nama Lengkap *"}),n.jsx(g,{value:Y.full_name,onChange:e=>Z({...Y,full_name:e.target.value}),placeholder:"Nama lengkap",required:!0})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(_,{className:"text-blue-700 font-bold",children:"Username *"}),n.jsx(g,{value:Y.username,onChange:e=>Z({...Y,username:e.target.value}),placeholder:"Username",required:!0})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(_,{className:"text-blue-700 font-bold",children:J?"Password (kosongkan jika tidak diubah)":"Password *"}),n.jsx(g,{type:"password",value:Y.password||"",onChange:e=>Z({...Y,password:e.target.value}),placeholder:"********",required:!J,className:"tracking-widest font-mono"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(_,{className:"text-blue-700 font-bold",children:"No. HP"}),n.jsx(g,{value:Y.no_hp,onChange:e=>Z({...Y,no_hp:e.target.value}),placeholder:"08xxxxxxxxxx"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(_,{className:"text-blue-700 font-bold",children:"Kecamatan"}),n.jsxs(C,{value:Y.kecamatan,onValueChange:e=>Z({...Y,kecamatan:e,kelurahan:""}),children:[n.jsx(U,{className:"border-2 border-blue-400 rounded-lg focus:ring-2 focus:ring-blue-300",children:n.jsx(K,{placeholder:"Pilih Kecamatan"})}),n.jsx(S,{children:ce.map(e=>n.jsx(P,{value:e,children:e},e))})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(_,{className:"text-blue-700 font-bold",children:"Kelurahan"}),n.jsxs(C,{value:Y.kelurahan,onValueChange:e=>Z({...Y,kelurahan:e}),children:[n.jsx(U,{className:"border-2 border-blue-400 rounded-lg focus:ring-2 focus:ring-blue-300",children:n.jsx(K,{placeholder:"Pilih Kelurahan"})}),n.jsx(S,{children:de.map(e=>n.jsx(P,{value:e,children:e},e))})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(_,{className:"text-blue-700 font-bold",children:"Role *"}),n.jsxs(C,{value:Y.role,onValueChange:e=>Z({...Y,role:e}),children:[n.jsx(U,{className:"border-2 border-blue-400 rounded-lg focus:ring-2 focus:ring-blue-300",children:n.jsx(K,{placeholder:"Pilih Role"})}),n.jsxs(S,{children:["// ...existing code...",n.jsx(P,{value:"admin_kecamatan",children:"Admin Kecamatan"}),n.jsx(P,{value:"admin_kelurahan",children:"Admin Kelurahan"})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[n.jsx(N,{type:"button",variant:"outline",onClick:()=>G(!1),children:"Batal"}),n.jsx(N,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:re.isPending||ne.isPending,children:re.isPending||ne.isPending?"Menyimpan...":J?"Update":"Tambah"})]})]})]})}),n.jsx(E,{open:!!W,onOpenChange:()=>X(null),children:n.jsxs(q,{children:[n.jsxs(L,{children:[n.jsx(D,{children:"Hapus User?"}),n.jsx(H,{children:"Tindakan ini tidak dapat dibatalkan. User akan dihapus secara permanen dari sistem."})]}),n.jsxs(T,{children:[n.jsx(B,{children:"Batal"}),n.jsx(F,{onClick:()=>te.mutate(W),className:"bg-red-600 hover:bg-red-700",children:"Hapus"})]})]})})]})}export{V as default};
//# sourceMappingURL=ManajemenUser-9FcyWbrs.js.map
