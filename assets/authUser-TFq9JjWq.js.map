{"version":3,"file":"authUser-TFq9JjWq.js","sources":["../../api/authUser.js"],"sourcesContent":["// authUser.js - Helper untuk login dan gabung data user Supabase Auth + tabel users\r\nimport { supabase } from './db';\r\n\r\n/**\r\n * Ambil user login (gabungan Supabase Auth dan tabel users)\r\n * @returns {Promise<object|null>} user gabungan atau null jika tidak login\r\n */\r\nexport async function getCurrentUser() {\r\n  // Ambil user dari Supabase Auth\r\n  const { data: { user: authUser } } = await supabase.auth.getUser();\r\n  if (!authUser) return null;\r\n\r\n  // Cari user di tabel users berdasarkan auth_id, uid, atau email\r\n  let userApp = null;\r\n\r\n  // 1. Cari berdasarkan auth_id\r\n  let { data } = await supabase\r\n    .from('users')\r\n    .select('*')\r\n    .eq('auth_id', authUser.id)\r\n    .single();\r\n  userApp = data;\r\n\r\n  // 2. Jika tidak ketemu, cari berdasarkan uid\r\n  if (!userApp) {\r\n    let { data } = await supabase\r\n      .from('users')\r\n      .select('*')\r\n      .eq('uid', authUser.id)\r\n      .single();\r\n    userApp = data;\r\n    // Jika ketemu, update auth_id\r\n    if (userApp && !userApp.auth_id) {\r\n      await supabase\r\n        .from('users')\r\n        .update({ auth_id: authUser.id })\r\n        .eq('id', userApp.id);\r\n    }\r\n  }\r\n\r\n  // 3. Jika tidak ketemu, cari berdasarkan email\r\n  if (!userApp && authUser.email) {\r\n    let { data } = await supabase\r\n      .from('users')\r\n      .select('*')\r\n      .eq('email', authUser.email)\r\n      .single();\r\n    userApp = data;\r\n    // Jika ketemu, update uid dan auth_id\r\n    if (userApp) {\r\n      await supabase\r\n        .from('users')\r\n        .update({ uid: authUser.id, auth_id: authUser.id })\r\n        .eq('id', userApp.id);\r\n    }\r\n  }\r\n\r\n  // Gabungkan data Auth dan Users jika ditemukan\r\n  return userApp ? { ...authUser, ...userApp } : null;\r\n}\r\n\r\n// Contoh penggunaan:\r\n// import { getCurrentUser } from '@/api/authUser';\r\n// const user = await getCurrentUser();\r\n"],"names":["getCurrentUser","authUser","supabase","userApp","data"],"mappings":"qCAOO,eAAeA,GAAiB,CAErC,KAAM,CAAE,KAAM,CAAE,KAAMC,CAAQ,CAAE,EAAK,MAAMC,EAAS,KAAK,UACzD,GAAI,CAACD,EAAU,OAAO,KAGtB,IAAIE,EAAU,KAGV,CAAE,KAAAC,CAAI,EAAK,MAAMF,EAClB,KAAK,OAAO,EACZ,OAAO,GAAG,EACV,GAAG,UAAWD,EAAS,EAAE,EACzB,SAIH,GAHAE,EAAUC,EAGN,CAACD,EAAS,CACZ,GAAI,CAAE,KAAAC,CAAI,EAAK,MAAMF,EAClB,KAAK,OAAO,EACZ,OAAO,GAAG,EACV,GAAG,MAAOD,EAAS,EAAE,EACrB,SACHE,EAAUC,EAEND,GAAW,CAACA,EAAQ,SACtB,MAAMD,EACH,KAAK,OAAO,EACZ,OAAO,CAAE,QAASD,EAAS,EAAE,CAAE,EAC/B,GAAG,KAAME,EAAQ,EAAE,CAE1B,CAGA,GAAI,CAACA,GAAWF,EAAS,MAAO,CAC9B,GAAI,CAAE,KAAAG,CAAI,EAAK,MAAMF,EAClB,KAAK,OAAO,EACZ,OAAO,GAAG,EACV,GAAG,QAASD,EAAS,KAAK,EAC1B,SACHE,EAAUC,EAEND,GACF,MAAMD,EACH,KAAK,OAAO,EACZ,OAAO,CAAE,IAAKD,EAAS,GAAI,QAASA,EAAS,GAAI,EACjD,GAAG,KAAME,EAAQ,EAAE,CAE1B,CAGA,OAAOA,EAAU,CAAE,GAAGF,EAAU,GAAGE,CAAO,EAAK,IACjD"}