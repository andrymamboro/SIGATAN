import{ao as U,r as n,v as y,j as e,s as N,H as W,K as z}from"./vendor-CDA6I53B.js";import{s as b}from"./db-CzWppX9X.js";import{g as A}from"./authUser-TFq9JjWq.js";import{C as S,a as C}from"./card-DKMhJA2Q.js";import{I as O}from"./input-CWJLU9W1.js";import{S as j,a as g,b as f,c as w,d as l}from"./select-DkHE2ADG.js";import{B as v}from"./badge-BNLm1yiM.js";import{T as $}from"./TanahMap-Cz2kfIE4.js";import"./leaflet-D651TNsF.js";import"./index-yx-jgwg1.js";import"./pdf-BL6BoWiN.js";import"./utils-DzPFn8M0.js";function re(){const K=()=>{window.history.length>1?window.history.back():window.location.assign("/dashboard")},[L]=U(),o=L.get("id"),[s,T]=n.useState(null),[c,q]=n.useState(""),[i,F]=n.useState("all"),[h,k]=n.useState("all"),[u,_]=n.useState("all");n.useEffect(()=>{(async()=>{const t=await A();T(t)})()},[]);const{data:D=[],isLoading:H}=y({queryKey:["tanah-peta",s?.kecamatan,s?.kelurahan,s?.role,s?.nik],queryFn:async()=>{if(!s)return[];let a=b.from("tanah").select("*");if(s.role!=="super_admin")if(s.role==="admin_kecamatan")a=a.eq("kecamatan",s.kecamatan);else if(s.role==="admin_kelurahan")a=a.eq("kelurahan",s.kelurahan);else if(s.role==="member")a=a.or(`nik_pemilik.eq.${s.nik},nik_penerima.eq.${s.nik}`);else return[];const{data:t,error:m}=await a;if(m)throw new Error(m.message);return t||[]},enabled:!!s}),{data:x=[]}=y({queryKey:["wilayah"],queryFn:async()=>{const{data:a,error:t}=await b.from("wilayah").select("*");if(t)throw new Error(t.message);return a||[]}}),E=[...new Set(x.map(a=>a.kecamatan))],P=i!=="all"?[...new Set(x.filter(a=>a.kecamatan===i).map(a=>a.kelurahan))]:[...new Set(x.map(a=>a.kelurahan))],p=D.filter(a=>{const t=a.nama_pemilik?.toLowerCase().includes(c.toLowerCase())||a.nama_penerima?.toLowerCase().includes(c.toLowerCase())||a.lokasi?.toLowerCase().includes(c.toLowerCase()),m=i==="all"||a.kecamatan===i,V=h==="all"||a.kelurahan===h,M=u==="all"||a.status===u;return t&&m&&V&&M}),r=p.filter(a=>a.latitude&&a.longitude),d=o?r.find(a=>parseInt(a.id)===parseInt(o)):null,B=d?[d.latitude,d.longitude]:r.length>0?[r[0].latitude,r[0].longitude]:[-.8317,119.8707],I=d?16:14;return e.jsxs("div",{className:"space-y-6 relative",children:[o&&e.jsxs("button",{onClick:K,className:"absolute top-2 right-2 z-50 bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white px-4 py-2 rounded shadow hover:brightness-110 transition-all flex items-center gap-2",title:"Kembali ke Data Tanah",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})}),"Kembali"]}),e.jsx("div",{children:e.jsx("p",{className:"text-slate-500 mt-1",children:"Visualisasi lokasi tanah berdasarkan koordinat"})}),s?.role!=="super_admin"&&e.jsx(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:e.jsx(S,{className:"border-0 shadow-md",children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(O,{placeholder:"Cari nama pemilik, penerima, atau lokasi...",value:c,onChange:a=>q(a.target.value),className:"pl-10"})]}),e.jsxs(j,{value:i,onValueChange:a=>{F(a),k("all")},children:[e.jsx(g,{className:"w-full",children:e.jsx(f,{placeholder:"Filter Kecamatan"})}),e.jsxs(w,{children:[e.jsx(l,{value:"all",children:"Semua Kecamatan"}),E.map(a=>e.jsx(l,{value:a,children:a},a))]})]}),e.jsxs(j,{value:h,onValueChange:k,children:[e.jsx(g,{className:"w-full",children:e.jsx(f,{placeholder:"Filter Kelurahan"})}),e.jsxs(w,{children:[e.jsx(l,{value:"all",children:"Semua Kelurahan"}),P.map(a=>e.jsx(l,{value:a,children:a},a))]})]}),e.jsxs(j,{value:u,onValueChange:_,children:[e.jsx(g,{className:"w-full",children:e.jsx(f,{placeholder:"Filter Status"})}),e.jsxs(w,{children:[e.jsx(l,{value:"all",children:"Semua Status"}),e.jsx(l,{value:"Proses",children:"Proses"}),e.jsx(l,{value:"Selesai",children:"Selesai"}),e.jsx(l,{value:"Ditolak",children:"Ditolak"})]})]})]})})})}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(v,{variant:"secondary",className:"bg-slate-100 text-slate-700 px-4 py-2",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Total: ",p.length," data"]}),e.jsxs(v,{variant:"secondary",className:"bg-green-100 text-green-700 px-4 py-2",children:["Dengan Koordinat: ",r.length]}),e.jsxs(v,{variant:"secondary",className:"bg-orange-100 text-orange-700 px-4 py-2",children:["Tanpa Koordinat: ",p.length-r.length]})]}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx($,{tanahList:r,center:B,zoom:I,selectedId:o})}),e.jsx(S,{className:"border-0 shadow-md",children:e.jsxs(C,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-slate-700 mb-3",children:"Keterangan Warna Marker:"}),e.jsxs("div",{className:"flex flex-wrap gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{background:"#fff",border:"2px solid #EAB308"}}),e.jsx("span",{className:"text-sm text-slate-600",children:"Dipilih"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Dalam Proses"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{background:"#EAB308"}}),e.jsx("span",{className:"text-sm text-slate-600",children:"Selesai"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Ditolak"})]})]})]})})]})}export{re as default};
//# sourceMappingURL=PetaTanah-C3GI6XdD.js.map
