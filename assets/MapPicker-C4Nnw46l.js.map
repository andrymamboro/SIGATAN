{"version":3,"file":"MapPicker-C4Nnw46l.js","sources":["../../Components/maps/MapPicker.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { LeafletContext } from './LeafletContext';\r\nimport { createPortal } from 'react-dom';\r\nimport { MapContainer, TileLayer, Marker, Polygon, useMap, useMapEvents } from 'react-leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport 'leaflet-draw/dist/leaflet.draw.css';\r\nimport L from 'leaflet';\r\nimport { createCircleIcon, getPolygonColors } from './utils';\r\nimport 'leaflet-draw';\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { MapPin, Navigation, Search, Loader2, Pencil, Map as MapIcon, Globe, Eye, EyeOff, Shapes, ShapesIcon } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\n// Fix for Leaflet pointer event warning\r\nif (typeof window !== 'undefined' && L.DomEvent) {\r\n  // Patch Leaflet to handle missing pointer events\r\n  const originalRemove = L.DomEvent.removePointerListener;\r\n  L.DomEvent.removePointerListener = function(obj, type, handler) {\r\n    const pointerEvents = {\r\n      pointerdown: true,\r\n      pointermove: true,\r\n      pointerup: true,\r\n      pointercancel: true,\r\n      pointerenter: true,\r\n      pointerleave: true,\r\n      pointerover: true,\r\n      pointerout: true\r\n    };\r\n    \r\n    if (!pointerEvents[type]) {\r\n      // Silently ignore invalid pointer events instead of warning\r\n      return;\r\n    }\r\n    \r\n    return originalRemove.call(this, obj, type, handler);\r\n  };\r\n}\r\n\r\n// Fix for default marker icon\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',\r\n  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',\r\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\r\n});\r\n\r\n// Hapus custom flagIcon, gunakan createCircleIcon dari utils.js\r\n\r\nfunction LocationMarker({ position, setPosition, mode }) {\r\n  const markerRef = useRef(null);\r\n\r\n  const map = useMapEvents({\r\n    click(e) {\r\n      if (mode === 'marker') {\r\n        setPosition([e.latlng.lat, e.latlng.lng]);\r\n      }\r\n    },\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (position && mode === 'marker') {\r\n      map.flyTo(position, map.getZoom());\r\n    }\r\n  }, [position, map, mode]);\r\n\r\n  const eventHandlers = {\r\n    dragend() {\r\n      const marker = markerRef.current;\r\n      if (marker != null) {\r\n        const pos = marker.getLatLng();\r\n        setPosition([pos.lat, pos.lng]);\r\n      }\r\n    },\r\n  };\r\n\r\n  // Gunakan icon yang sama dengan TanahMap\r\n  return position ? (\r\n    <Marker\r\n      draggable={mode === 'marker'}\r\n      eventHandlers={eventHandlers}\r\n      position={position}\r\n      ref={markerRef}\r\n      icon={createCircleIcon('Ungu', 20)}\r\n    />\r\n  ) : null;\r\n}\r\n\r\nfunction DrawControl({ onPolygonComplete, polygonCoords, mode }) {\r\n  const map = useMap();\r\n  const drawnItemsRef = useRef(new L.FeatureGroup());\r\n\r\n  useEffect(() => {\r\n    if (mode !== 'polygon') return;\r\n\r\n    const drawnItems = drawnItemsRef.current;\r\n    map.addLayer(drawnItems);\r\n\r\n    // Load existing polygon if provided\r\n    if (polygonCoords && polygonCoords.length > 0) {\r\n      const polygon = L.polygon(polygonCoords, {\r\n        color: '#3b82f6',\r\n        fillColor: '#3b82f6',\r\n        fillOpacity: 0.3,\r\n        weight: 1\r\n      });\r\n      drawnItems.addLayer(polygon);\r\n    }\r\n\r\n    const drawControl = new L.Control.Draw({\r\n      draw: {\r\n        polygon: {\r\n          allowIntersection: false,\r\n          shapeOptions: {\r\n            color: '#3b82f6',\r\n            fillColor: '#3b82f6',\r\n            fillOpacity: 0.3,\r\n            weight: 1\r\n          }\r\n        },\r\n        polyline: false,\r\n        rectangle: false,\r\n        circle: false,\r\n        marker: false,\r\n        circlemarker: false\r\n      },\r\n      edit: {\r\n        featureGroup: drawnItems,\r\n        remove: true\r\n      }\r\n    });\r\n\r\n    map.addControl(drawControl);\r\n\r\n    map.on(L.Draw.Event.CREATED, (e) => {\r\n      const layer = e.layer;\r\n      drawnItems.clearLayers();\r\n      drawnItems.addLayer(layer);\r\n      const coords = layer.getLatLngs()[0].map(latlng => [latlng.lat, latlng.lng]);\r\n      onPolygonComplete(coords);\r\n    });\r\n\r\n    map.on(L.Draw.Event.EDITED, (e) => {\r\n      const layers = e.layers;\r\n      layers.eachLayer((layer) => {\r\n        const coords = layer.getLatLngs()[0].map(latlng => [latlng.lat, latlng.lng]);\r\n        onPolygonComplete(coords);\r\n      });\r\n    });\r\n\r\n    map.on(L.Draw.Event.DELETED, () => {\r\n      onPolygonComplete(null);\r\n    });\r\n\r\n    return () => {\r\n      map.removeControl(drawControl);\r\n      map.removeLayer(drawnItems);\r\n      map.off(L.Draw.Event.CREATED);\r\n      map.off(L.Draw.Event.EDITED);\r\n      map.off(L.Draw.Event.DELETED);\r\n    };\r\n  }, [map, mode, onPolygonComplete]);\r\n\r\n  return null;\r\n}\r\n\r\nexport default function MapPicker({ initialPosition = [-0.7861746, 119.8689641], initialPolygon = null, initialMode = 'marker', existingTanahData = [], onSelectLocation, onClose }) {\r\n  // Example value for context, you can expand as needed\r\n  const leafletContextValue = { initialPosition, initialPolygon, initialMode };\r\n  const [position, setPosition] = useState(initialPosition);\r\n  const [mapType, setMapType] = useState('satellite');\r\n  const [loading, setLoading] = useState(false);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [mode, setMode] = useState(initialMode);\r\n  const [polygonCoords, setPolygonCoords] = useState(initialPolygon);\r\n  const [editingPointIndex, setEditingPointIndex] = useState(null);\r\n  const [showMarkers, setShowMarkers] = useState(true);\r\n  const [showPolygons, setShowPolygons] = useState(true);\r\n\r\n  const getCurrentLocation = () => {\r\n    setLoading(true);\r\n    if (navigator.geolocation) {\r\n      navigator.geolocation.getCurrentPosition(\r\n        (pos) => {\r\n          const newPos = [pos.coords.latitude, pos.coords.longitude];\r\n          setPosition(newPos);\r\n          setLoading(false);\r\n          toast.success('Lokasi berhasil didapatkan');\r\n        },\r\n        (error) => {\r\n          setLoading(false);\r\n          toast.error('Gagal mendapatkan lokasi. Pastikan GPS aktif dan izinkan akses lokasi.');\r\n          console.error(error);\r\n        },\r\n        {\r\n          enableHighAccuracy: true,\r\n          timeout: 10000,\r\n          maximumAge: 0\r\n        }\r\n      );\r\n    } else {\r\n      setLoading(false);\r\n      toast.error('Browser tidak mendukung geolokasi');\r\n    }\r\n  };\r\n\r\n  const handleSearch = async () => {\r\n    if (!searchQuery.trim() || searchQuery.trim().length < 2) return;\r\n    \r\n    setLoading(true);\r\n    try {\r\n      const response = await fetch(\r\n        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchQuery)}&limit=1`\r\n      );\r\n      const data = await response.json();\r\n      \r\n      if (data && data.length > 0) {\r\n        const newPos = [parseFloat(data[0].lat), parseFloat(data[0].lon)];\r\n        setPosition(newPos);\r\n        toast.success('Lokasi ditemukan');\r\n      } else {\r\n        toast.error('Lokasi tidak ditemukan');\r\n      }\r\n    } catch (error) {\r\n      toast.error('Gagal mencari lokasi');\r\n      console.error(error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleConfirm = () => {\r\n    if (mode === 'marker') {\r\n      onSelectLocation({\r\n        latitude: position[0],\r\n        longitude: position[1],\r\n        type: 'marker'\r\n      });\r\n    } else if (mode === 'polygon' && polygonCoords) {\r\n      // Calculate center of polygon\r\n      const latSum = polygonCoords.reduce((sum, coord) => sum + coord[0], 0);\r\n      const lngSum = polygonCoords.reduce((sum, coord) => sum + coord[1], 0);\r\n      const centerLat = latSum / polygonCoords.length;\r\n      const centerLng = lngSum / polygonCoords.length;\r\n      \r\n      onSelectLocation({\r\n        latitude: centerLat,\r\n        longitude: centerLng,\r\n        type: 'polygon',\r\n        polygon: polygonCoords\r\n      });\r\n    } else {\r\n      toast.error('Silakan gambar polygon terlebih dahulu');\r\n      return;\r\n    }\r\n    onClose();\r\n  };\r\n\r\n  const tileLayers = {\r\n    satellite: {\r\n      // Google Hybrid (unofficial, for demo/educational use only)\r\n      url: 'https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}',\r\n      attribution: 'Map data ©2025 Google, Imagery ©2025 TerraMetrics',\r\n    },\r\n    street: {\r\n      url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\r\n      attribution: 'Map data ©2025 Google, Imagery ©2025 TerraMetrics',\r\n    },\r\n  };\r\n\r\n  function FloatingControls() {\r\n    const isSatellite = mapType === 'satellite';\r\n    return (\r\n      <div style={{ position: 'absolute', top: 12, left: 56, zIndex: 1000, display: 'flex', flexDirection: 'row', gap: 8 }}>\r\n        {/* Map type toggle button */}\r\n              {/* Mode toggle button (marker/polygon) */}\r\n        \r\n        <Button\r\n          onClick={getCurrentLocation}\r\n          disabled={loading}\r\n          className={`h-8 px-2 ${loading ? 'bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white' : 'bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 text-white'}`}\r\n          title=\"Gunakan Lokasi GPS Saya\"\r\n        >\r\n          {loading ? (\r\n            <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n          ) : (\r\n            <Navigation className=\"w-4 h-4\" />\r\n          )}\r\n        </Button>\r\n        {/* Drawing mode trigger button (existing) */}\r\n        \r\n        {/* Tambahan 2 tombol */}\r\n        <Button\r\n          className={`h-8 px-2 ${showMarkers ? 'bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white' : 'bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 text-gray-700'}`}\r\n          title={showMarkers ? 'Sembunyikan Marker' : 'Tampilkan Marker'}\r\n          onClick={() => setShowMarkers(v => !v)}\r\n        >\r\n          {showMarkers ? <Eye className=\"w-4 h-4\" /> : <EyeOff className=\"w-4 h-4\" />}\r\n        </Button>\r\n        \r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setMode(mode === 'marker' ? 'polygon' : 'marker')}\r\n          className={mode === 'marker'\r\n            ? 'bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white border border-blue-900 rounded w-8 h-8 flex items-center justify-center shadow transition-colors duration-200'\r\n            : 'bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 text-white border border-blue-700 rounded w-8 h-8 flex items-center justify-center shadow transition-colors duration-200'}\r\n          title={mode === 'marker' ? 'Ganti ke mode gambar Petak' : 'Ganti ke Marker'}\r\n        >\r\n          {mode === 'marker' ? (\r\n            <Pencil style={{ width: 14, height: 14 }} />\r\n          ) : (\r\n            <MapPin style={{ width: 14, height: 14 }} />\r\n          )}\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <LeafletContext.Provider value={leafletContextValue}>\r\n      <>\r\n        <div className=\"space-y-4\">\r\n\r\n\r\n      {/* Map */}\r\n      <Card className=\"overflow-hidden\" style={{ position: 'relative' }}>\r\n        <FloatingControls />\r\n        <MapContainer\r\n          center={position}\r\n          zoom={15}\r\n          style={{ height: '550px', width: '100%' }}\r\n        >\r\n          <TileLayer\r\n            url={tileLayers[mapType].url}\r\n            attribution={tileLayers[mapType].attribution}\r\n          />\r\n          {/* Marker klik/tap selalu tampil */}\r\n          <LocationMarker position={position} setPosition={setPosition} mode={mode} />\r\n          <DrawControl \r\n            mode={mode}\r\n            onPolygonComplete={setPolygonCoords}\r\n            polygonCoords={polygonCoords}\r\n          />\r\n          {showPolygons && polygonCoords && Array.isArray(polygonCoords) && polygonCoords.length >= 3 && mode === 'polygon' && (\r\n            <Polygon\r\n              positions={polygonCoords}\r\n              pathOptions={{\r\n                color: '#3b82f6',\r\n                fillColor: '#3b82f6',\r\n                fillOpacity: 0.3,\r\n                weight: 2\r\n              }}\r\n            />\r\n          )}\r\n          {/* Show existing tanah data */}\r\n          {existingTanahData.map((tanah) => {\r\n            if (!tanah.latitude || !tanah.longitude) return null;\r\n            let { color } = getPolygonColors(tanah.status, false);\r\n            if (tanah.status === 'Selesai') color = '#f97316'; // orange\r\n            const positionDb = [tanah.latitude, tanah.longitude];\r\n            // Parse polygon/polyline coords if string\r\n            let coords = null;\r\n            if ((tanah.location_type === 'polygon' || tanah.location_type === 'polyline') && tanah.polygon_coords) {\r\n              try {\r\n                coords = typeof tanah.polygon_coords === 'string'\r\n                  ? JSON.parse(tanah.polygon_coords)\r\n                  : tanah.polygon_coords;\r\n                if (!Array.isArray(coords) || coords.length < 2) {\r\n                  coords = null;\r\n                }\r\n              } catch (e) {\r\n                coords = null;\r\n              }\r\n            }\r\n            return (\r\n              <React.Fragment key={tanah.id}>\r\n                {/* Polygon jika titik >= 3, Polyline jika titik >= 2 dan < 3 */}\r\n                {coords && coords.length >= 3 ? (\r\n                  <Polygon\r\n                    positions={coords}\r\n                    pathOptions={{\r\n                      color: color,\r\n                      fillColor: color,\r\n                      fillOpacity: 0.2,\r\n                      weight: 2,\r\n                    }}\r\n                  />\r\n                ) : coords && coords.length === 2 ? (\r\n                  <Polyline\r\n                    positions={coords}\r\n                    pathOptions={{\r\n                      color: color,\r\n                      weight: 2,\r\n                    }}\r\n                  />\r\n                ) : null}\r\n                {/* Marker database hanya tampil jika showMarkers aktif */}\r\n                {showMarkers && (\r\n                  <Marker\r\n                    position={positionDb}\r\n                    icon={createCircleIcon(tanah.status || 'Selesai', 20)}\r\n                  />\r\n                )}\r\n              </React.Fragment>\r\n            );\r\n          })}\r\n        </MapContainer>\r\n      </Card>\r\n\r\n      {/* Coordinates Display */}\r\n      {mode === 'marker' && (\r\n        <Card className=\"p-4\">\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <Label className=\"text-sm text-slate-600\">Latitude</Label>\r\n              <Input\r\n                value={position[0].toFixed(7)}\r\n                onChange={(e) => {\r\n                  const val = parseFloat(e.target.value);\r\n                  if (!isNaN(val)) setPosition([val, position[1]]);\r\n                }}\r\n                type=\"number\"\r\n                step=\"0.0000001\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label className=\"text-sm text-slate-600\">Longitude</Label>\r\n              <Input\r\n                value={position[1].toFixed(7)}\r\n                onChange={(e) => {\r\n                  const val = parseFloat(e.target.value);\r\n                  if (!isNaN(val)) setPosition([position[0], val]);\r\n                }}\r\n                type=\"number\"\r\n                step=\"0.0000001\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </Card>\r\n      )}\r\n\r\n      {mode === 'polygon' && (\r\n        <Card className=\"p-4\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <Label className=\"text-sm text-slate-600\">\r\n              Koordinat Polygon {polygonCoords ? `(${polygonCoords.length} titik)` : ''}\r\n            </Label>\r\n            <Button\r\n              size=\"sm\"\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                const newCoords = polygonCoords || [];\r\n                newCoords.push([position[0], position[1]]);\r\n                setPolygonCoords([...newCoords]);\r\n              }}\r\n            >\r\n              + Tambah Titik\r\n            </Button>\r\n          </div>\r\n          \r\n          {polygonCoords && polygonCoords.length > 0 ? (\r\n            <div className=\"max-h-48 overflow-y-auto\" style={{ gap: '0.375rem', display: 'flex', flexDirection: 'column' }}>\r\n              {polygonCoords.map((coord, idx) => (\r\n                <div key={idx} className=\"flex items-center gap-2 bg-slate-50 p-2 rounded\">\r\n                  <span className=\"text-xs font-semibold text-slate-500 w-6\">{idx + 1}.</span>\r\n                  <div className=\"flex-1 grid grid-cols-2 gap-2\">\r\n                    <Input\r\n                      type=\"number\"\r\n                      step=\"0.000001\"\r\n                      value={coord[0]}\r\n                      onChange={(e) => {\r\n                        const newCoords = [...polygonCoords];\r\n                        newCoords[idx][0] = parseFloat(e.target.value) || 0;\r\n                        setPolygonCoords(newCoords);\r\n                      }}\r\n                      className=\"h-8 text-xs\"\r\n                      placeholder=\"Latitude\"\r\n                    />\r\n                    <Input\r\n                      type=\"number\"\r\n                      step=\"0.000001\"\r\n                      value={coord[1]}\r\n                      onChange={(e) => {\r\n                        const newCoords = [...polygonCoords];\r\n                        newCoords[idx][1] = parseFloat(e.target.value) || 0;\r\n                        setPolygonCoords(newCoords);\r\n                      }}\r\n                      className=\"h-8 text-xs\"\r\n                      placeholder=\"Longitude\"\r\n                    />\r\n                  </div>\r\n                  <Button\r\n                    size=\"sm\"\r\n                    variant=\"ghost\"\r\n                    onClick={() => {\r\n                      const newCoords = polygonCoords.filter((_, i) => i !== idx);\r\n                      setPolygonCoords(newCoords.length > 0 ? newCoords : null);\r\n                    }}\r\n                    className=\"h-8 px-2 text-red-600 hover:text-red-700 hover:bg-red-50\"\r\n                  >\r\n                    ✕\r\n                  </Button>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-4 text-sm text-slate-400\">\r\n              Belum ada titik polygon. Gambar di peta atau tambah manual.\r\n            </div>\r\n          )}\r\n        </Card>\r\n      )}\r\n\r\n      {/* Action Buttons */}\r\n      <div className=\"flex justify-end gap-3 pr-4\">\r\n        <Button variant=\"outline\" onClick={onClose}>\r\n          Batal\r\n        </Button>\r\n        <Button \r\n          onClick={handleConfirm}\r\n          className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n        >\r\n          <MapPin className=\"w-4 h-4 mr-2\" />\r\n          Pilih Lokasi Ini\r\n        </Button>\r\n        {/* Instructions */}\r\n      </div>\r\n      </div>\r\n      </>\r\n    </LeafletContext.Provider>\r\n  );\r\n}"],"names":["L","originalRemove","obj","type","handler","LocationMarker","position","setPosition","mode","markerRef","useRef","map","useMapEvents","e","useEffect","eventHandlers","marker","pos","jsx","Marker","createCircleIcon","DrawControl","onPolygonComplete","polygonCoords","useMap","drawnItemsRef","drawnItems","polygon","drawControl","layer","coords","latlng","MapPicker","initialPosition","initialPolygon","initialMode","existingTanahData","onSelectLocation","onClose","leafletContextValue","useState","mapType","setMapType","loading","setLoading","searchQuery","setSearchQuery","setMode","setPolygonCoords","editingPointIndex","setEditingPointIndex","showMarkers","setShowMarkers","showPolygons","setShowPolygons","getCurrentLocation","newPos","toast","error","handleConfirm","latSum","sum","coord","lngSum","centerLat","centerLng","tileLayers","FloatingControls","Button","Loader2","Navigation","v","Eye","EyeOff","Pencil","MapPin","LeafletContext","Fragment","jsxs","Card","MapContainer","TileLayer","Polygon","tanah","color","getPolygonColors","positionDb","React","Label","Input","val","newCoords","idx","_","i"],"mappings":"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"}