import{r as e,k as a,s,y as t,A as l,j as r,F as i,P as n,D as d,L as c,E as o,w as x,H as m,I as h,J as p,K as u,O as g,V as j}from"./vendor-B-UrjPD3.js";import{B as w,c as b,s as f}from"./index-DFbN_dxx.js";import{Card as N,CardContent as k}from"./card-iZaV0svU.js";import{I as v,D as y,a as _,b as C,c as S}from"./dialog-DMm488yB.js";import{S as D,a as $,b as q,c as T,d as L}from"./select-Be3TM5P1.js";import{A as P,a as z,b as E,c as K,d as F,e as H,f as I,g as M}from"./alert-dialog-C_crUFbm.js";import"./pdf-Dy1nE1k0.js";function R(){const[R,B]=e.useState(1),[A,G]=e.useState(null),[Q,O]=e.useState(""),[U,V]=e.useState("all"),[J,W]=e.useState(null),[X,Y]=e.useState(null),Z=a();e.useEffect(()=>{B(1)},[Q,U]);const{data:ee=[],isLoading:ae,error:se}=s({queryKey:["tanah",A?.kecamatan,A?.kelurahan,A?.role,A?.nik],queryFn:async()=>{if(!A)return[];let e=f.from("tanah").select("*");if("super_admin"===A.role);else if("admin_kecamatan"===A.role)e=e.eq("kecamatan",A.kecamatan);else if("admin_kelurahan"===A.role)e=e.eq("kelurahan",A.kelurahan);else{if("member"!==A.role)return[];e=e.or(`nik_pemilik.eq.${A.nik},nik_penerima.eq.${A.nik}`)}e=e.order("created_date",{ascending:!1});const{data:a,error:s}=await e;if(s)throw console.error("Supabase tanah error:",s),new Error(s.message);return a||[]},enabled:!!A}),te=ee.filter(e=>{const a=e.nama_pemilik?.toLowerCase().includes(Q.toLowerCase())||e.nama_penerima?.toLowerCase().includes(Q.toLowerCase())||e.nik_pemilik?.includes(Q)||e.lokasi?.toLowerCase().includes(Q.toLowerCase()),s="all"===U||e.status===U;return a&&s}),le=Math.ceil(te.length/7),re=te.slice(7*(R-1),7*R),ie=t();e.useEffect(()=>{(async()=>{const{data:{user:e}}=await f.auth.getUser();if(e){const{data:a}=await f.from("users").select("*").eq("auth_id",e.id).single();G({...e,...a})}})()},[]);const ne=l({mutationFn:async e=>{const{error:a}=await f.from("tanah").delete().eq("id",e);if(a)throw new Error(a.message)},onSuccess:()=>{ie.invalidateQueries(["tanah"]),W(null),j.success("Data tanah berhasil dihapus")},onError:e=>{j.error("Gagal menghapus data: "+(e.message||e))}});return r.jsxs("div",{className:"space-y-6 w-full",children:[r.jsxs("div",{className:"",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[r.jsxs("div",{children:[r.jsxs("h1",{className:"text-1xl font-bold text-white flex items-center gap-3",children:[r.jsx(i,{className:"w-8 h-8 text-blue-200"}),"Data Tanah"]}),r.jsx("p",{className:"text-white text-sm mt-0",children:"Kelola data tanah dan dokumen pertanahan"})]}),r.jsxs(w,{onClick:()=>Z("/formtanah"),className:"bg-gradient-to-r border border-2 border-white from-blue-700 via-blue-800 to-blue-900 text-white shadow hover:brightness-110",children:[r.jsx(n,{className:"w-4 h-4 mr-2"}),"Tambah Data"]})]}),r.jsx(N,{className:"border-0 bg-transparent",children:r.jsxs(k,{className:"p-4 flex flex-wrap gap-4 justify-between items-center",children:[r.jsxs("div",{className:"font-normal text-white text-sm",children:["Total: ",te.length," data"]}),r.jsxs("div",{className:"font-normal text-white text-sm",children:["Dengan Koordinat:"," ",te.filter(e=>e.latitude&&e.longitude).length]}),r.jsxs("div",{className:"font-normal text-white text-sm",children:["Tanpa Koordinat:"," ",te.filter(e=>!e.latitude||!e.longitude).length]}),r.jsxs("div",{className:"flex items-start gap-4 mt-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"inline-block w-5 h-5 rounded-full",style:{background:"#EAB308",border:"2px solid #fff",boxShadow:"0 2px 5px rgba(0,0,0,0.15)"}}),r.jsx("span",{className:"text-sm text-white font-medium",children:"Selesai"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"inline-block w-5 h-5 rounded-full",style:{background:"#3b82f6",border:"2px solid #fff",boxShadow:"0 2px 5px rgba(0,0,0,0.15)"}}),r.jsx("span",{className:"text-sm text-white font-medium",children:"Proses"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"inline-block w-5 h-5 rounded-full",style:{background:"#ef4444",border:"2px solid #fff",boxShadow:"0 2px 5px rgba(0,0,0,0.15)"}}),r.jsx("span",{className:"text-sm text-white font-medium",children:"Ditolak"})]})]})]})}),r.jsx(N,{className:"border-0 shadow-md bg-transparent text-white",children:r.jsx(k,{className:"p-4 border-0 shadow-sm bg-transparent",children:r.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[r.jsxs("div",{className:"flex-1 relative",children:[r.jsx(d,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white"}),r.jsx(v,{placeholder:"Cari nama, NIK, atau lokasi...",value:Q,onChange:e=>O(e.target.value),className:"pl-10 pr-4 h-10 bg-transparent border-white text-white placeholder-white",style:{"::placeholder-text":{color:"#fff"}}})]}),r.jsxs(D,{value:U,onValueChange:V,children:[r.jsx($,{className:"w-full md:w-48",children:r.jsx(q,{placeholder:"Filter Status"})}),r.jsxs(T,{children:[r.jsx(L,{value:"all",children:"Semua Status"}),r.jsx(L,{value:"Proses",children:"Proses"}),r.jsx(L,{value:"Selesai",children:"Selesai"}),r.jsx(L,{value:"Ditolak",children:"Ditolak"})]})]})]})})})]}),ae?r.jsx("div",{className:"flex justify-center items-center py-12 text-white text-lg",children:"Memuat data..."}):r.jsx("div",{className:"relative",style:{height:"60vh",minHeight:350},children:r.jsxs("div",{className:"grid gap-4 overflow-auto h-full pr-2",style:{maxHeight:"100%"},children:[r.jsx("div",{className:"overflow-auto rounded-lg shadow bg-white",children:r.jsxs("table",{className:"min-w-full border border-gray-300 w-full",children:[r.jsx("thead",{className:"bg-blue-700",children:r.jsxs("tr",{className:"border-b-2 border-gray-300",children:[r.jsx("th",{className:"px-2 py-2 text-left text-xs font-sm text-white uppercase tracking-wider w-8",children:"No"}),r.jsx("th",{className:"px-4 py-2 text-left text-xs font-sm text-white uppercase tracking-wider",children:"Nama Pemohon"}),r.jsx("th",{className:"px-4 py-2 text-left text-xs font-sm text-white uppercase tracking-wider",children:"Nama Penerima"}),r.jsx("th",{className:"px-4 py-2 text-left text-xs font-sm text-white uppercase tracking-wider",children:"Transaksi"}),r.jsx("th",{className:"px-4 py-2 text-left text-xs font-sm text-white uppercase tracking-wider",children:"Luas"}),r.jsx("th",{className:"px-4 py-2 text-left text-xs font-sm text-white uppercase tracking-wider",children:"Wilayah"}),r.jsx("th",{className:"px-4 py-2 text-left text-xs font-sm text-white uppercase tracking-wider",children:"Status"}),r.jsx("th",{className:"px-4 py-2 text-left text-xs font-sm text-white uppercase tracking-wider",children:"Aksi"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200 ",children:re.map((e,a)=>r.jsxs("tr",{className:a%2==0?"bg-white":"bg-gray-300",children:[r.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-black w-8 text-center align-top ",children:7*(R-1)+a+1}),r.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-black align-top ",children:e.nama_pemilik}),r.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-black align-top ",children:[e.nama_penerima||"-",e.atas_nama&&r.jsx("div",{className:"text-xs text-gray-500",children:e.atas_nama})]}),r.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-black ",children:[e.transaksi||"-",e.transaksi&&r.jsxs("div",{className:"text-xs text-gray-500",children:[" Rp.",e.harga?.toLocaleString("id-ID")]})]}),r.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-black ",children:[e.luas_meter%1==0?Math.floor(e.luas_meter):e.luas_meter.toString().replace(".",",")," ","m²",r.jsxs("div",{className:"text-xs text-gray-500",children:["[ ",e.luas_perkalian," ]"]})]}),r.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-black ",children:[e.kelurahan||"-",e.kelurahan&&r.jsx("div",{className:"text-xs text-gray-500",children:e.kecamatan})]}),r.jsx("td",{className:"px-4 py-2 whitespace-nowrap ",children:r.jsx("span",{className:"Selesai"===e.status?"bg-yellow-500 text-white-400 px-2 py-1 rounded text-xs":"Ditolak"===e.status?"bg-red-500 text-white-400 px-2 py-1 rounded text-xs":"bg-blue-500 text-white-400 px-2 py-1 rounded text-xs",children:e.status||"Proses"})}),r.jsxs("td",{className:"px-2 py-2 whitespace-nowrap flex  gap-2",children:[r.jsx(c,{to:b("DetailTanah")+`?id=${e.id}`,children:r.jsxs(w,{variant:"outline",size:"sm",className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:[r.jsx(o,{className:"w-4 h-4 mr-1"}),"Detail"]})}),r.jsx(c,{to:b("PetaTanah")+`?id=${e.id}`,children:r.jsxs(w,{variant:"outline",size:"sm",className:e.latitude&&e.longitude?"text-teal-600 border-teal-200 hover:bg-teal-50":"text-slate-400 border-slate-200",disabled:!e.latitude||!e.longitude,children:[r.jsx(x,{className:"w-4 h-4 mr-1"}),"Peta"]})}),r.jsx(w,{variant:"outline",size:"sm",onClick:()=>Z(`/formtanah?id=${e.id}`),className:"text-orange-600 border-orange-200 hover:bg-orange-50",children:r.jsx(m,{className:"w-4 h-4"})}),r.jsx(w,{variant:"outline",size:"sm",onClick:()=>{const a=`${e.nama_pemilik} → ${e.nama_penerima} (${e.transaksi||"Transaksi"})`;Z(`/laporan?tanah=${encodeURIComponent(a)}`)},className:"text-purple-600 border-purple-200 hover:bg-purple-50",children:r.jsx(h,{className:"w-4 h-4"})}),r.jsx(w,{variant:"outline",size:"sm",onClick:()=>Y(e),className:"text-green-600 border-green-200 hover:bg-green-50",children:r.jsx(p,{className:"w-4 h-4"})}),r.jsx(w,{variant:"outline",size:"sm",onClick:()=>W(e.id),className:"text-red-600 border-red-200 hover:bg-red-50",children:r.jsx(u,{className:"w-4 h-4"})})]})]},e.id))})]})}),0===te.length&&r.jsx(N,{className:"border-0 shadow-md",children:r.jsxs(k,{className:"p-12 text-center",children:[r.jsx(i,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-slate-600",children:"Belum ada data tanah"}),r.jsx("p",{className:"text-slate-400 mt-1",children:'Klik tombol "Tambah Data" untuk menambahkan data baru'})]})})]})}),le>1&&r.jsxs("div",{className:"flex justify-center items-center gap-2 mt-6",children:[r.jsx(w,{onClick:()=>B(R-1),disabled:1===R,className:"px-3 py-1 rounded bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white disabled:opacity-50",children:"<"}),r.jsxs("span",{className:"text-sm text-white",children:["Halaman ",R," dari ",le]}),r.jsx(w,{onClick:()=>B(R+1),disabled:R===le,className:"px-3 py-1 border border-2 border-white rounded bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white disabled:opacity-50",children:">"})]}),se&&r.jsxs("div",{className:"p-4 bg-red-100 text-red-700 rounded mb-4",children:["Gagal memuat data tanah: ",se.message]}),r.jsx(P,{open:!!J,onOpenChange:e=>{e||W(null)},children:r.jsxs(z,{className:"bg-white",children:[r.jsxs(E,{children:[r.jsx(K,{children:"Hapus Data Tanah?"}),r.jsx(F,{children:"Tindakan ini tidak dapat dibatalkan. Data tanah akan dihapus secara permanen."})]}),r.jsxs(H,{children:[r.jsx(I,{children:"Batal"}),r.jsx(M,{onClick:()=>ne.mutate(J),className:"bg-red-600 hover:bg-red-700",children:"Hapus"})]})]})}),r.jsx(y,{open:!!X,onOpenChange:()=>Y(null),children:r.jsxs(_,{className:"sm:max-w-md",children:[r.jsx(C,{children:r.jsx(S,{className:"text-center",children:"QR Code Lokasi Tanah"})}),r.jsxs("div",{className:"flex flex-col items-center space-y-4 p-4",children:[r.jsxs("div",{className:"text-center space-y-1",children:[r.jsxs("p",{className:"font-medium text-slate-800",children:[X?.nama_pemilik,X?.nama_penerima&&r.jsxs(r.Fragment,{children:[" diserahkan kepada ",X?.nama_penerima]}),X?.atas_nama&&r.jsxs(r.Fragment,{children:[" / ",X?.atas_nama]})]}),r.jsxs("p",{className:"text-sm text-slate-500",children:[(X?.luas_meter||0)%1==0?Math.floor(X?.luas_meter||0):(X?.luas_meter||0).toString().replace(".",",")," ","m²"]}),r.jsxs("p",{className:"text-xs text-slate-400",children:[X?.latitude,", ",X?.longitude]})]}),r.jsx("div",{className:"bg-white p-4 rounded-lg border-2 border-slate-200",children:r.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(`https://www.google.com/maps?q=${X?.latitude},${X?.longitude}`)}`,alt:"QR Code",className:"w-64 h-64"})}),r.jsx("p",{className:"text-xs text-center text-slate-500",children:"Scan QR code untuk melihat lokasi di Google Maps"}),r.jsxs(w,{onClick:()=>{const e=`https://www.google.com/maps?q=${X?.latitude},${X?.longitude}`;window.open(e,"_blank")},className:"w-full bg-green-600 hover:bg-green-700",children:[r.jsx(g,{className:"w-4 h-4 mr-2"}),"Buka di Google Maps"]})]})]})})]})}export{R as default};
//# sourceMappingURL=DataTanah-DwtehrOn.js.map
