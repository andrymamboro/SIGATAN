import{r as a,y as e,s,A as t,j as l,U as r,P as n,D as i,as as c,ar as d,at as x,H as h,K as m,V as o}from"./vendor-B-UrjPD3.js";import{s as j}from"./db-BLqj6fe8.js";import{Card as p,CardContent as u}from"./card-iZaV0svU.js";import{B as b}from"./index-DFbN_dxx.js";import{I as g,D as N,a as f,b as w,c as k}from"./dialog-DMm488yB.js";import{L as v}from"./label-96Ix7DGT.js";import{S as y,a as P,b as C,c as S,d as K}from"./select-Be3TM5P1.js";import{B as D}from"./badge-B7sJnBCz.js";import{A as q,a as L,b as A,c as E,d as B,e as F,f as I,g as J}from"./alert-dialog-C_crUFbm.js";import"./pdf-Dy1nE1k0.js";const V=["Camat","Lurah","Kasi Pemerintahan","Staf Administrasi Kecamatan"];function T(){const[T,H]=a.useState(null),[Q,U]=a.useState(""),[z,O]=a.useState("all"),[M,W]=a.useState(!1),[_,G]=a.useState(null),[R,X]=a.useState(null),[Y,Z]=a.useState({kecamatan:"",kelurahan:"",nama:"",jabatan:"",nip:"",selaku:"",aktif:!0}),$=e();a.useEffect(()=>{(async()=>{const{data:{user:a}}=await j.auth.getUser();if(a){const{data:e}=await j.from("users").select("*").eq("auth_id",a.id).single();H(e)}})()},[]);const{data:aa=[],isLoading:ea}=s({queryKey:["pejabat"],queryFn:async()=>{const{data:a,error:e}=await j.from("pejabat").select("*");if(e)throw new Error(e.message);return a||[]}}),{data:sa=[]}=s({queryKey:["wilayah"],queryFn:async()=>{const{data:a,error:e}=await j.from("wilayah").select("*");if(e)throw new Error(e.message);return a||[]}}),ta=t({mutationFn:async a=>{const{error:e}=await j.from("pejabat").insert([a]);if(e)throw new Error(e.message)},onSuccess:()=>{$.invalidateQueries(["pejabat"]),W(!1),na(),o.success("Data pejabat berhasil ditambahkan")}}),la=t({mutationFn:async({id:a,data:e})=>{const{error:s}=await j.from("pejabat").update(e).eq("id",a);if(s)throw new Error(s.message)},onSuccess:()=>{$.invalidateQueries(["pejabat"]),W(!1),G(null),na(),o.success("Data pejabat berhasil diperbarui")}}),ra=t({mutationFn:async a=>{const{error:e}=await j.from("pejabat").delete().eq("id",a);if(e)throw new Error(e.message)},onSuccess:()=>{$.invalidateQueries(["pejabat"]),X(null),o.success("Data pejabat berhasil dihapus")}}),na=()=>{Z({kecamatan:"",kelurahan:"",nama:"",jabatan:"",nip:"",selaku:"",aktif:!0})},ia=[...new Set(sa.map(a=>a.kecamatan))],ca=Y.kecamatan?[...new Set(sa.filter(a=>a.kecamatan===Y.kecamatan).map(a=>a.kelurahan))]:[],da=aa.filter(a=>{const e=a.nama?.toLowerCase().includes(Q.toLowerCase())||a.nip?.includes(Q)||a.kecamatan?.toLowerCase().includes(Q.toLowerCase()),s="all"===z||a.jabatan===z;return e&&s}),xa={Camat:"bg-purple-100 text-purple-700",Lurah:"bg-blue-100 text-blue-700","Kasi Pemerintahan":"bg-emerald-100 text-emerald-700","Staf Administrasi Kecamatan":"bg-orange-100 text-orange-700"};return l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[l.jsxs("div",{children:[l.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[l.jsx(r,{className:"w-8 h-8 text-white"}),"Data Pejabat"]}),l.jsx("p",{className:"text-white mt-1",children:"Kelola data pejabat penanda tangan"})]}),l.jsxs(b,{onClick:()=>{G(null),na(),W(!0)},className:"bg-blue-600 hover:bg-blue-900 text-white",children:[l.jsx(n,{className:"w-4 h-4 mr-2"}),"Tambah Pejabat"]})]}),l.jsx(p,{className:"border-0 shadow-md bg-transparent",children:l.jsx(u,{className:"p-4",children:l.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[l.jsxs("div",{className:"flex-1 relative",children:[l.jsx(i,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),l.jsx(g,{placeholder:"Cari nama, NIP, atau kecamatan...",value:Q,onChange:a=>U(a.target.value),className:"pl-10 border-2 border-white-500 text-white placeholder-white"})]}),l.jsxs(y,{value:z,onValueChange:O,children:[l.jsx(P,{className:"w-full md:w-64 border-2 border-white-500 text-white",children:l.jsx(C,{placeholder:"Filter Jabatan"})}),l.jsxs(S,{children:[l.jsx(K,{value:"all",children:"Semua Jabatan"}),V.map(a=>l.jsx(K,{value:a,children:a},a))]})]})]})})}),l.jsx(p,{className:"border-0 shadow-lg",children:l.jsx(u,{className:"p-0",children:0===da.length?l.jsxs("div",{className:"p-12 text-center",children:[l.jsx(r,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-medium text-slate-600",children:"Belum ada data pejabat"}),l.jsx("p",{className:"text-slate-400 mt-1",children:'Klik tombol "Tambah Pejabat" untuk menambahkan data baru'})]}):l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("table",{className:"w-full",children:[l.jsx("thead",{className:"bg-blue-700 border-b-2 border-blue-700",children:l.jsxs("tr",{children:[l.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"No"}),l.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Nama & NIP"}),l.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Jabatan"}),l.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Wilayah"}),l.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Selaku"}),l.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-white uppercase tracking-wider",children:"Status"}),l.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-white uppercase tracking-wider",children:"Aksi"})]})}),l.jsx("tbody",{className:"bg-white divide-y divide-slate-100",children:l.jsx(c,{children:da.map((a,e)=>l.jsxs(d.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:.03*e},className:"hover:bg-slate-50 transition-colors duration-150 "+(e%2==1?"bg-gray-300":"bg-white"),children:[l.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-600",children:e+1}),l.jsx("td",{className:"px-6 py-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-md flex-shrink-0",children:l.jsx("span",{className:"text-white text-sm font-bold",children:a.nama?.charAt(0).toUpperCase()||"P"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-semibold text-slate-800",children:a.nama}),l.jsxs("p",{className:"text-xs text-slate-500",children:["NIP: ",a.nip||"-"]})]})]})}),l.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l.jsx(D,{className:xa[a.jabatan]||"bg-slate-100 text-slate-700",children:a.jabatan})}),l.jsx("td",{className:"px-6 py-4",children:l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(x,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),l.jsxs("div",{className:"text-sm text-slate-600",children:[l.jsx("p",{className:"font-medium",children:a.kecamatan}),a.kelurahan&&l.jsx("p",{className:"text-slate-500",children:a.kelurahan})]})]})}),l.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:a.selaku||"-"}),l.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:l.jsx(D,{className:!1!==a.aktif?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200",children:!1!==a.aktif?"Aktif":"Non-aktif"})}),l.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx(b,{variant:"ghost",size:"sm",onClick:()=>(a=>{G(a),Z({kecamatan:a.kecamatan||"",kelurahan:a.kelurahan||"",nama:a.nama||"",jabatan:a.jabatan||"",nip:a.nip||"",selaku:a.selaku||"",aktif:!1!==a.aktif}),W(!0)})(a),className:"text-blue-600 hover:text-green-700 hover:bg-green-50",children:l.jsx(h,{className:"w-4 h-4"})}),l.jsx(b,{variant:"ghost",size:"sm",onClick:()=>X(a.id),className:"text-red-600 hover:text-green-700 hover:bg-blue-50",children:l.jsx(m,{className:"w-4 h-4"})})]})})]},a.id))})})]})})})}),l.jsx(N,{open:M,onOpenChange:W,children:l.jsxs(f,{className:"max-w-lg bg-gray-100",children:[l.jsxs(w,{children:[l.jsx(k,{className:"text-xl",children:_?"Edit Data Pejabat":"Tambah Pejabat Baru"}),"          "]}),l.jsxs("form",{onSubmit:a=>{a.preventDefault(),_?la.mutate({id:_.id,data:Y}):ta.mutate(Y)},className:"space-y-4 mt-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(v,{children:"Kecamatan *"}),l.jsxs(y,{value:Y.kecamatan,onValueChange:a=>Z({...Y,kecamatan:a,kelurahan:""}),children:[l.jsx(P,{className:"border-2 border-blue-500",children:l.jsx(C,{placeholder:"Pilih Kecamatan"})}),l.jsx(S,{children:ia.map(a=>l.jsx(K,{value:a,children:a},a))})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(v,{children:"Kelurahan"}),l.jsxs(y,{value:Y.kelurahan,onValueChange:a=>Z({...Y,kelurahan:a}),children:[l.jsx(P,{className:"border-2 border-blue-500",children:l.jsx(C,{placeholder:"Pilih Kelurahan"})}),l.jsx(S,{children:ca.map(a=>l.jsx(K,{value:a,children:a},a))})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(v,{className:"",children:"Nama Pejabat *"}),l.jsx(g,{className:"",value:Y.nama,onChange:a=>Z({...Y,nama:a.target.value}),placeholder:"Nama lengkap",required:!0})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(v,{children:"Jabatan *"}),l.jsxs(y,{value:Y.jabatan,onValueChange:a=>Z({...Y,jabatan:a}),children:[l.jsx(P,{className:"border-2 border-blue-500",children:l.jsx(C,{placeholder:"Pilih Jabatan"})}),l.jsx(S,{children:V.map(a=>l.jsx(K,{value:a,children:a},a))})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(v,{children:"NIP"}),l.jsx(g,{value:Y.nip,onChange:a=>Z({...Y,nip:a.target.value}),placeholder:"Nomor Induk Pegawai"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(v,{children:"Selaku"}),l.jsx(g,{value:Y.selaku,onChange:a=>Z({...Y,selaku:a.target.value}),placeholder:"Contoh: Pengelola Data Pertanahan"})]}),l.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[l.jsx(b,{type:"button",variant:"outline",onClick:()=>W(!1),children:"Batal"}),l.jsx(b,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:ta.isPending||la.isPending,children:ta.isPending||la.isPending?"Menyimpan...":"Simpan"})]})]})]})}),l.jsx(q,{open:!!R,onOpenChange:()=>X(null),children:l.jsxs(L,{children:[l.jsxs(A,{children:[l.jsx(E,{children:"Hapus Data Pejabat?"}),l.jsx(B,{children:"Tindakan ini tidak dapat dibatalkan. Data pejabat akan dihapus secara permanen."})]}),l.jsxs(F,{children:[l.jsx(I,{children:"Batal"}),l.jsx(J,{onClick:()=>ra.mutate(R),className:"bg-red-600 hover:bg-red-700",children:"Hapus"})]})]})})]})}export{T as default};
//# sourceMappingURL=Pejabat-3_hZNcS1.js.map
