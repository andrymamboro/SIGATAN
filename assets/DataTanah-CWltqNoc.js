import{r as n,l as I,v as U,D as z,G as B,j as e,w as y,P as F,H as Q,I as K,s as H,J as R,K as C,L as S,E as G,O,T as V,V as J,W,Y,Z as _}from"./vendor-CDA6I53B.js";import{B as r,c as D,s as m}from"./index-yx-jgwg1.js";import{C as b,a as N}from"./card-DKMhJA2Q.js";import{I as Z}from"./input-CWJLU9W1.js";import{S as X,a as ee,b as ae,c as se,d as x}from"./select-DkHE2ADG.js";import{B as te}from"./badge-BNLm1yiM.js";import{A as le,a as re,b as ie,c as ne,d as ce,e as oe,f as de,g as me}from"./alert-dialog-DIAaR8u9.js";import{D as xe,a as ue,b as he,c as pe}from"./dialog-DQrH_2W9.js";import"./leaflet-D651TNsF.js";import"./pdf-BL6BoWiN.js";function Se(){const[c,u]=n.useState(1),h=5,[t,T]=n.useState(null),[o,P]=n.useState(""),[d,q]=n.useState("all"),[k,p]=n.useState(null),[s,w]=n.useState(null),g=I();n.useEffect(()=>{u(1)},[o,d]);const{data:$=[],isLoading:A,error:v}=U({queryKey:["tanah",t?.kecamatan,t?.kelurahan,t?.role,t?.nik],queryFn:async()=>{if(!t)return[];let a=m.from("tanah").select("*");if(t.role!=="super_admin")if(t.role==="admin_kecamatan")a=a.eq("kecamatan",t.kecamatan);else if(t.role==="admin_kelurahan")a=a.eq("kelurahan",t.kelurahan);else if(t.role==="member")a=a.or(`nik_pemilik.eq.${t.nik},nik_penerima.eq.${t.nik}`);else return[];a=a.order("created_date",{ascending:!1});const{data:l,error:i}=await a;if(i)throw console.error("Supabase tanah error:",i),new Error(i.message);return l||[]},enabled:!!t}),j=$.filter(a=>{const l=a.nama_pemilik?.toLowerCase().includes(o.toLowerCase())||a.nama_penerima?.toLowerCase().includes(o.toLowerCase())||a.nik_pemilik?.includes(o)||a.lokasi?.toLowerCase().includes(o.toLowerCase()),i=d==="all"||a.status===d;return l&&i}),f=Math.ceil(j.length/h),L=j.slice((c-1)*h,c*h),E=z();n.useEffect(()=>{(async()=>{const{data:{user:l}}=await m.auth.getUser();if(l){const{data:i}=await m.from("users").select("*").eq("auth_id",l.id).single();T({...l,...i})}})()},[]);const M=B({mutationFn:async a=>{const{error:l}=await m.from("tanah").delete().eq("id",a);if(l)throw new Error(l.message)},onSuccess:()=>{E.invalidateQueries(["tanah"]),p(null),_.success("Data tanah berhasil dihapus")},onError:a=>{_.error("Gagal menghapus data: "+(a.message||a))}});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-800 flex items-center gap-3",children:[e.jsx(y,{className:"w-8 h-8 text-blue-600"}),"Data Tanah"]}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Kelola data tanah dan dokumen pertanahan"})]}),e.jsxs(r,{onClick:()=>g("/formtanah"),className:"bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white shadow hover:brightness-110",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Tambah Data"]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-5 h-5 rounded-full",style:{background:"#EAB308",border:"2px solid #fff",boxShadow:"0 2px 5px rgba(0,0,0,0.15)"}}),e.jsx("span",{className:"text-sm text-slate-700 font-medium",children:"Selesai"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-5 h-5 rounded-full",style:{background:"#3b82f6",border:"2px solid #fff",boxShadow:"0 2px 5px rgba(0,0,0,0.15)"}}),e.jsx("span",{className:"text-sm text-slate-700 font-medium",children:"Proses"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-5 h-5 rounded-full",style:{background:"#ef4444",border:"2px solid #fff",boxShadow:"0 2px 5px rgba(0,0,0,0.15)"}}),e.jsx("span",{className:"text-sm text-slate-700 font-medium",children:"Ditolak"})]})]}),e.jsx(b,{className:"border-0 shadow-md",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Z,{placeholder:"Cari nama, NIK, atau lokasi...",value:o,onChange:a=>P(a.target.value),className:"pl-10"})]}),e.jsxs(X,{value:d,onValueChange:q,children:[e.jsx(ee,{className:"w-full md:w-48",children:e.jsx(ae,{placeholder:"Filter Status"})}),e.jsxs(se,{children:[e.jsx(x,{value:"all",children:"Semua Status"}),e.jsx(x,{value:"Proses",children:"Proses"}),e.jsx(x,{value:"Selesai",children:"Selesai"}),e.jsx(x,{value:"Ditolak",children:"Ditolak"})]})]})]})})}),A?e.jsx("div",{className:"flex justify-center items-center py-12 text-slate-500 text-lg",children:"Memuat data..."}):e.jsxs("div",{className:"grid gap-4",children:[e.jsx(K,{children:L.map((a,l)=>e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:l*.05},children:e.jsx(b,{className:"border-0 shadow-md hover:shadow-lg transition-all duration-300",children:e.jsx(N,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg text-slate-800 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-blue-600"}),a.nama_pemilik]}),e.jsxs("p",{className:"text-sm text-slate-500",children:["NIK: ",a.nik_pemilik]})]}),e.jsx(te,{className:a.status==="Selesai"?"bg-yellow-100 text-yellow-700":a.status==="Ditolak"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700",children:a.status||"Proses"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"w-4 h-4 text-slate-400"}),a.lokasi]}),e.jsxs("div",{children:["Luas: ",a.luas_meter%1===0?Math.floor(a.luas_meter):a.luas_meter.toString().replace(".",",")," m²"]}),e.jsxs("div",{children:["Kelurahan: ",a.kelurahan]})]}),a.nama_penerima&&e.jsx("div",{className:"text-sm text-slate-600",children:e.jsxs("strong",{children:[e.jsx("span",{className:"font-medium",children:"Penerima:"})," ",a.nama_penerima,a.transaksi&&e.jsxs("span",{className:"text-slate-400 ml-2",children:["(",a.transaksi,")"]})]})}),a.location_type&&e.jsxs("div",{className:"text-xs text-slate-400",children:["Tipe Lokasi: ",a.location_type]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{to:D("DetailTanah")+`?id=${a.id}`,children:e.jsxs(r,{variant:"outline",size:"sm",className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Detail"]})}),e.jsx(S,{to:D("PetaTanah")+`?id=${a.id}`,children:e.jsxs(r,{variant:"outline",size:"sm",className:a.latitude&&a.longitude?"text-teal-600 border-teal-200 hover:bg-teal-50":"text-slate-400 border-slate-200",disabled:!a.latitude||!a.longitude,children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Peta"]})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>g(`/formtanah?id=${a.id}`),className:"text-orange-600 border-orange-200 hover:bg-orange-50",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>{const i=`${a.nama_pemilik} → ${a.nama_penerima} (${a.transaksi||"Transaksi"})`;g(`/laporan?tanah=${encodeURIComponent(i)}`)},className:"text-purple-600 border-purple-200 hover:bg-purple-50",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>w(a),className:"text-green-600 border-green-200 hover:bg-green-50",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>p(a.id),className:"text-red-600 border-red-200 hover:bg-red-50",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})})})},a.id))}),j.length===0&&e.jsx(b,{className:"border-0 shadow-md",children:e.jsxs(N,{className:"p-12 text-center",children:[e.jsx(y,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-600",children:"Belum ada data tanah"}),e.jsx("p",{className:"text-slate-400 mt-1",children:'Klik tombol "Tambah Data" untuk menambahkan data baru'})]})})]}),f>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-6",children:[e.jsx(r,{onClick:()=>u(c-1),disabled:c===1,className:"px-3 py-1 rounded bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white disabled:opacity-50",children:"<"}),e.jsxs("span",{className:"text-sm text-slate-700",children:["Halaman ",c," dari ",f]}),e.jsx(r,{onClick:()=>u(c+1),disabled:c===f,className:"px-3 py-1 rounded bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white disabled:opacity-50",children:">"})]}),v&&e.jsxs("div",{className:"p-4 bg-red-100 text-red-700 rounded mb-4",children:["Gagal memuat data tanah: ",v.message]}),e.jsx(le,{open:!!k,onOpenChange:a=>{a||p(null)},children:e.jsxs(re,{children:[e.jsxs(ie,{children:[e.jsx(ne,{children:"Hapus Data Tanah?"}),e.jsx(ce,{children:"Tindakan ini tidak dapat dibatalkan. Data tanah akan dihapus secara permanen."})]}),e.jsxs(oe,{children:[e.jsx(de,{children:"Batal"}),e.jsx(me,{onClick:()=>M.mutate(k),className:"bg-red-600 hover:bg-red-700",children:"Hapus"})]})]})}),e.jsx(xe,{open:!!s,onOpenChange:()=>w(null),children:e.jsxs(ue,{className:"sm:max-w-md",children:[e.jsx(he,{children:e.jsx(pe,{className:"text-center",children:"QR Code Lokasi Tanah"})}),e.jsxs("div",{className:"flex flex-col items-center space-y-4 p-4",children:[e.jsxs("div",{className:"text-center space-y-1",children:[e.jsxs("p",{className:"font-medium text-slate-800",children:[s?.nama_pemilik,s?.nama_penerima&&e.jsxs(e.Fragment,{children:[" diserahkan kepada ",s?.nama_penerima]}),s?.atas_nama&&e.jsxs(e.Fragment,{children:[" / ",s?.atas_nama]})]}),e.jsxs("p",{className:"text-sm text-slate-500",children:[(s?.luas_meter||0)%1===0?Math.floor(s?.luas_meter||0):(s?.luas_meter||0).toString().replace(".",",")," m²"]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[s?.latitude,", ",s?.longitude]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg border-2 border-slate-200",children:e.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(`https://www.google.com/maps?q=${s?.latitude},${s?.longitude}`)}`,alt:"QR Code",className:"w-64 h-64"})}),e.jsx("p",{className:"text-xs text-center text-slate-500",children:"Scan QR code untuk melihat lokasi di Google Maps"}),e.jsxs(r,{onClick:()=>{const a=`https://www.google.com/maps?q=${s?.latitude},${s?.longitude}`;window.open(a,"_blank")},className:"w-full bg-green-600 hover:bg-green-700",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Buka di Google Maps"]})]})]})})]})}export{Se as default};
//# sourceMappingURL=DataTanah-CWltqNoc.js.map
