import{r as u,j as e,R as U,K as T,Z as E,am as $,aT as H,E as K,A as Q,T as Z}from"./vendor-CDA6I53B.js";import{L as J,g as V,c as G}from"./utils-DzPFn8M0.js";import{M as q,T as W,P as I,d as O,e as X,u as Y,L as i}from"./leaflet-D651TNsF.js";import{C as S}from"./card-DKMhJA2Q.js";import{B as j}from"./index-yx-jgwg1.js";import{I as N}from"./input-CWJLU9W1.js";import{L as M}from"./label-wcoL3QN2.js";import"./tabs-bRrHKpzy.js";if(typeof window<"u"&&i.DomEvent){const n=i.DomEvent.removePointerListener;i.DomEvent.removePointerListener=function(d,c,l){if({pointerdown:!0,pointermove:!0,pointerup:!0,pointercancel:!0,pointerenter:!0,pointerleave:!0,pointerover:!0,pointerout:!0}[c])return n.call(this,d,c,l)}}delete i.Icon.Default.prototype._getIconUrl;i.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});function ee({position:n,setPosition:d,mode:c}){const l=u.useRef(null),x=X({click(p){c==="marker"&&d([p.latlng.lat,p.latlng.lng])}});u.useEffect(()=>{n&&c==="marker"&&x.flyTo(n,x.getZoom())},[n,x,c]);const g={dragend(){const p=l.current;if(p!=null){const o=p.getLatLng();d([o.lat,o.lng])}}};return n?e.jsx(O,{draggable:c==="marker",eventHandlers:g,position:n,ref:l,icon:G("Ungu",20)}):null}function te({onPolygonComplete:n,polygonCoords:d,mode:c}){const l=Y(),x=u.useRef(new i.FeatureGroup);return u.useEffect(()=>{if(c!=="polygon")return;const g=x.current;if(l.addLayer(g),d&&d.length>0){const o=i.polygon(d,{color:"#3b82f6",fillColor:"#3b82f6",fillOpacity:.3,weight:1});g.addLayer(o)}const p=new i.Control.Draw({draw:{polygon:{allowIntersection:!1,shapeOptions:{color:"#3b82f6",fillColor:"#3b82f6",fillOpacity:.3,weight:1}},polyline:!1,rectangle:!1,circle:!1,marker:!1,circlemarker:!1},edit:{featureGroup:g,remove:!0}});return l.addControl(p),l.on(i.Draw.Event.CREATED,o=>{const h=o.layer;g.clearLayers(),g.addLayer(h);const y=h.getLatLngs()[0].map(k=>[k.lat,k.lng]);n(y)}),l.on(i.Draw.Event.EDITED,o=>{o.layers.eachLayer(y=>{const k=y.getLatLngs()[0].map(b=>[b.lat,b.lng]);n(k)})}),l.on(i.Draw.Event.DELETED,()=>{n(null)}),()=>{l.removeControl(p),l.removeLayer(g),l.off(i.Draw.Event.CREATED),l.off(i.Draw.Event.EDITED),l.off(i.Draw.Event.DELETED)}},[l,c,n]),null}function fe({initialPosition:n=[-.7861746,119.8689641],initialPolygon:d=null,initialMode:c="marker",existingTanahData:l=[],onSelectLocation:x,onClose:g}){const p={initialPosition:n,initialPolygon:d,initialMode:c},[o,h]=u.useState(n),[y,k]=u.useState("satellite"),[b,L]=u.useState(!1),[re,ae]=u.useState(""),[m,R]=u.useState(c),[r,w]=u.useState(d),[se,oe]=u.useState(null),[C,F]=u.useState(!0),[A,le]=u.useState(!0),z=()=>{L(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const a=[t.coords.latitude,t.coords.longitude];h(a),L(!1),E.success("Lokasi berhasil didapatkan")},t=>{L(!1),E.error("Gagal mendapatkan lokasi. Pastikan GPS aktif dan izinkan akses lokasi."),console.error(t)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):(L(!1),E.error("Browser tidak mendukung geolokasi"))},_=()=>{if(m==="marker")x({latitude:o[0],longitude:o[1],type:"marker"});else if(m==="polygon"&&r){const t=r.reduce((v,D)=>v+D[0],0),a=r.reduce((v,D)=>v+D[1],0),f=t/r.length,s=a/r.length;x({latitude:f,longitude:s,type:"polygon",polygon:r})}else{E.error("Silakan gambar polygon terlebih dahulu");return}g()},P={satellite:{url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",attribution:"Map data ©2025 Google, Imagery ©2025 TerraMetrics"},street:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"Map data ©2025 Google, Imagery ©2025 TerraMetrics"}};function B(){return e.jsxs("div",{style:{position:"absolute",top:12,left:56,zIndex:1e3,display:"flex",flexDirection:"row",gap:8},children:[e.jsx(j,{onClick:z,disabled:b,className:`h-8 px-2 ${b?"bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white":"bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 text-white"}`,title:"Gunakan Lokasi GPS Saya",children:b?e.jsx($,{className:"w-4 h-4 animate-spin"}):e.jsx(H,{className:"w-4 h-4"})}),e.jsx(j,{className:`h-8 px-2 ${C?"bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white":"bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 text-gray-700"}`,title:C?"Sembunyikan Marker":"Tampilkan Marker",onClick:()=>F(t=>!t),children:C?e.jsx(K,{className:"w-4 h-4"}):e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>R(m==="marker"?"polygon":"marker"),className:m==="marker"?"bg-gradient-to-r from-blue-700 via-blue-800 to-blue-900 text-white border border-blue-900 rounded w-8 h-8 flex items-center justify-center shadow transition-colors duration-200":"bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 text-white border border-blue-700 rounded w-8 h-8 flex items-center justify-center shadow transition-colors duration-200",title:m==="marker"?"Ganti ke mode gambar Petak":"Ganti ke Marker",children:m==="marker"?e.jsx(Z,{style:{width:14,height:14}}):e.jsx(T,{style:{width:14,height:14}})})]})}return e.jsx(J.Provider,{value:p,children:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(S,{className:"overflow-hidden",style:{position:"relative"},children:[e.jsx(B,{}),e.jsxs(q,{center:o,zoom:15,style:{height:"550px",width:"100%"},children:[e.jsx(W,{url:P[y].url,attribution:P[y].attribution}),e.jsx(ee,{position:o,setPosition:h,mode:m}),e.jsx(te,{mode:m,onPolygonComplete:w,polygonCoords:r}),A&&r&&Array.isArray(r)&&r.length>=3&&m==="polygon"&&e.jsx(I,{positions:r,pathOptions:{color:"#3b82f6",fillColor:"#3b82f6",fillOpacity:.3,weight:2}}),l.map(t=>{if(!t.latitude||!t.longitude)return null;let{color:a}=V(t.status,!1);t.status==="Selesai"&&(a="#f97316");const f=[t.latitude,t.longitude];let s=null;if((t.location_type==="polygon"||t.location_type==="polyline")&&t.polygon_coords)try{s=typeof t.polygon_coords=="string"?JSON.parse(t.polygon_coords):t.polygon_coords,(!Array.isArray(s)||s.length<2)&&(s=null)}catch{s=null}return e.jsxs(U.Fragment,{children:[s&&s.length>=3?e.jsx(I,{positions:s,pathOptions:{color:a,fillColor:a,fillOpacity:.2,weight:2}}):s&&s.length===2?e.jsx(Polyline,{positions:s,pathOptions:{color:a,weight:2}}):null,C&&e.jsx(O,{position:f,icon:G(t.status||"Selesai",20)})]},t.id)})]})]}),m==="marker"&&e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{className:"text-sm text-slate-600",children:"Latitude"}),e.jsx(N,{value:o[0].toFixed(7),onChange:t=>{const a=parseFloat(t.target.value);isNaN(a)||h([a,o[1]])},type:"number",step:"0.0000001"})]}),e.jsxs("div",{children:[e.jsx(M,{className:"text-sm text-slate-600",children:"Longitude"}),e.jsx(N,{value:o[1].toFixed(7),onChange:t=>{const a=parseFloat(t.target.value);isNaN(a)||h([o[0],a])},type:"number",step:"0.0000001"})]})]})}),m==="polygon"&&e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(M,{className:"text-sm text-slate-600",children:["Koordinat Polygon ",r?`(${r.length} titik)`:""]}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>{const t=r||[];t.push([o[0],o[1]]),w([...t])},children:"+ Tambah Titik"})]}),r&&r.length>0?e.jsx("div",{className:"max-h-48 overflow-y-auto",style:{gap:"0.375rem",display:"flex",flexDirection:"column"},children:r.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 p-2 rounded",children:[e.jsxs("span",{className:"text-xs font-semibold text-slate-500 w-6",children:[a+1,"."]}),e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-2",children:[e.jsx(N,{type:"number",step:"0.000001",value:t[0],onChange:f=>{const s=[...r];s[a][0]=parseFloat(f.target.value)||0,w(s)},className:"h-8 text-xs",placeholder:"Latitude"}),e.jsx(N,{type:"number",step:"0.000001",value:t[1],onChange:f=>{const s=[...r];s[a][1]=parseFloat(f.target.value)||0,w(s)},className:"h-8 text-xs",placeholder:"Longitude"})]}),e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>{const f=r.filter((s,v)=>v!==a);w(f.length>0?f:null)},className:"h-8 px-2 text-red-600 hover:text-red-700 hover:bg-red-50",children:"✕"})]},a))}):e.jsx("div",{className:"text-center py-4 text-sm text-slate-400",children:"Belum ada titik polygon. Gambar di peta atau tambah manual."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pr-4",children:[e.jsx(j,{variant:"outline",onClick:g,children:"Batal"}),e.jsxs(j,{onClick:_,className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Pilih Lokasi Ini"]})]})]})})})}export{fe as M};
//# sourceMappingURL=MapPicker-C4Nnw46l.js.map
