import{r as l,j as a,T as M,Y as T,C as q,aZ as A}from"./vendor-BKp2tr96.js";import{s as b}from"./db-DOO1oGDP.js";import{D as P,a as z,b as B,c as G}from"./dialog-BPgVm2Ic.js";import{B as c}from"./index-C5rwQ5l5.js";import{I as m}from"./input-yVzg1dOJ.js";import"./leaflet-C2x5yPDR.js";import"./pdf-DglC5ngP.js";function Q(){const[h,x]=l.useState([]),[u,K]=l.useState(""),[o,p]=l.useState(1),j=5,g=h.filter(e=>e.kecamatan?.toLowerCase().includes(u.toLowerCase())||e.kelurahan?.toLowerCase().includes(u.toLowerCase())||(e.kode_wilayah||"").toLowerCase().includes(u.toLowerCase())),k=Math.ceil(g.length/j)||1,N=g.slice((o-1)*j,o*j),[w,v]=l.useState(!0),[f,D]=l.useState(null),[y,d]=l.useState(!1),[r,_]=l.useState(null),[t,i]=l.useState({kecamatan:"",kelurahan:"",kode_wilayah:"",alamat_kantor_kecamatan:"",alamat_kantor_kelurahan:""}),[C,S]=l.useState(!1),[I,W]=l.useState(null),E=async e=>{if(!window.confirm("Yakin ingin menghapus data wilayah ini?"))return;const{error:s}=await b.from("wilayah").delete().eq("id",e);s?alert("Gagal hapus: "+s.message):(x(h.filter(n=>n.id!==e)),W(null))};l.useEffect(()=>{y?r&&i({kecamatan:r.kecamatan||"",kelurahan:r.kelurahan||"",kode_wilayah:r.kode_wilayah||"",alamat_kantor_kecamatan:r.alamat_kantor_kecamatan||"",alamat_kantor_kelurahan:r.alamat_kantor_kelurahan||""}):(i({kecamatan:"",kelurahan:"",kode_wilayah:""}),_(null))},[y,r]);const L=async e=>{if(e.preventDefault(),S(!0),r){const{error:s}=await b.from("wilayah").update(t).eq("id",r.id);s?alert("Gagal update: "+s.message):(x(h.map(n=>n.id===r.id?{...n,...t}:n)),d(!1))}else{const{data:s,error:n}=await b.from("wilayah").insert([t]).select();!n&&s&&s[0]?(x([...h,s[0]]),d(!1)):alert("Gagal tambah: "+(n?.message||""))}S(!1)};return l.useEffect(()=>{(async()=>{v(!0);const{data:s,error:n}=await b.from("wilayah").select("*").order("kecamatan",{ascending:!0});n?D(n.message):x(s||[]),v(!1)})()},[]),a.jsxs("div",{className:"p-8",children:[a.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Data Wilayah"}),w&&a.jsx("p",{children:"Memuat data wilayah..."}),f&&a.jsxs("p",{className:"text-red-500",children:["Gagal memuat data: ",f]}),!w&&!f&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[a.jsx(c,{onClick:()=>d(!0),className:"bg-blue-600",children:"Tambah Wilayah"}),a.jsx("div",{className:"flex-1 flex justify-end",children:a.jsx(m,{type:"text",placeholder:"Cari kecamatan, kelurahan, kode...",value:u,onChange:e=>{K(e.target.value),p(1)},className:"w-full md:w-64"})})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full border border-slate-300 bg-white",children:[a.jsx("thead",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-blue-900 text-white",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 border",children:"No"}),a.jsx("th",{className:"px-4 py-2 border",children:"Kecamatan"}),a.jsx("th",{className:"px-4 py-2 border",children:"Kelurahan"}),a.jsx("th",{className:"px-4 py-2 border",children:"Kode Wilayah"}),a.jsx("th",{className:"px-4 py-2 border",children:"Alamat Kantor Kecamatan"}),a.jsx("th",{className:"px-4 py-2 border",children:"Alamat Kantor Kelurahan"}),a.jsx("th",{className:"px-4 py-2 border text-center",children:"Aksi"})]})}),a.jsx("tbody",{children:N.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"text-center py-4 text-slate-400",children:"Tidak ada data"})}):N.map((e,s)=>a.jsxs("tr",{className:"hover:bg-slate-50",children:[a.jsx("td",{className:"px-4 py-2 border text-center",children:(o-1)*j+s+1}),a.jsx("td",{className:"px-4 py-2 border",children:e.kecamatan}),a.jsx("td",{className:"px-4 py-2 border",children:e.kelurahan}),a.jsx("td",{className:"px-4 py-2 border",children:e.kode_wilayah||"-"}),a.jsx("td",{className:"px-4 py-2 border",children:e.alamat_kantor_kecamatan||"-"}),a.jsx("td",{className:"px-4 py-2 border",children:e.alamat_kantor_kelurahan||"-"}),a.jsx("td",{className:"px-4 py-2 border text-center",children:a.jsxs("div",{className:"flex justify-center gap-2",children:[a.jsx(c,{size:"icon",variant:"ghost",onClick:()=>{_(e),d(!0)},"aria-label":"Edit",children:a.jsx(M,{className:"w-5 h-5 text-blue-600"})}),a.jsx(c,{size:"icon",variant:"ghost",onClick:()=>E(e.id),"aria-label":"Delete",children:a.jsx(T,{className:"w-5 h-5 text-red-600"})})]})})]},e.id||s))})]})}),a.jsxs("div",{className:"flex justify-between items-center mt-4",children:[a.jsxs("span",{className:"text-sm text-slate-500",children:["Halaman ",o," dari ",k]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(c,{size:"icon",variant:"outline",onClick:()=>p(e=>Math.max(1,e-1)),disabled:o===1,"aria-label":"Sebelumnya",children:a.jsx(q,{className:"w-5 h-5 text-blue-600"})}),a.jsx(c,{size:"icon",variant:"outline",onClick:()=>p(e=>Math.min(k,e+1)),disabled:o===k,"aria-label":"Berikutnya",children:a.jsx(A,{className:"w-5 h-5 text-blue-600"})})]})]}),a.jsx(P,{open:y,onOpenChange:d,children:a.jsxs(z,{className:"max-w-md",children:[a.jsx(B,{children:a.jsx(G,{children:r?"Edit Wilayah":"Tambah Wilayah"})}),a.jsxs("form",{onSubmit:L,className:"space-y-4 mt-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kecamatan"}),a.jsx(m,{value:t.kecamatan,onChange:e=>i({...t,kecamatan:e.target.value}),required:!0,autoFocus:!0,disabled:window?.user?.role==="super_admin"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kelurahan"}),a.jsx(m,{value:t.kelurahan,onChange:e=>i({...t,kelurahan:e.target.value}),required:!0,disabled:window?.user?.role==="super_admin"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kode Wilayah"}),a.jsx(m,{value:t.kode_wilayah,onChange:e=>i({...t,kode_wilayah:e.target.value}),required:!0,disabled:window?.user?.role==="super_admin"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium mb-1 text-blue-900 font-weight-bold",children:["Alamat Kantor Kecamatan ",t.kecamatan]}),a.jsx(m,{value:t.alamat_kantor_kecamatan,onChange:e=>i({...t,alamat_kantor_kecamatan:e.target.value})})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium mb-1 text-blue-900 font-weight-bold",children:["Alamat Kantor Kelurahan ",t.kelurahan]}),a.jsx(m,{value:t.alamat_kantor_kelurahan,onChange:e=>i({...t,alamat_kantor_kelurahan:e.target.value})})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[a.jsx(c,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Batal"}),a.jsx(c,{type:"submit",className:"bg-blue-600",disabled:C,children:C?"Menyimpan...":"Simpan"})]})]})]})})]})]})}export{Q as default};
//# sourceMappingURL=Wilayah-Dwm1iuSW.js.map
